<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Blueschisting - transit</title><link href="/" rel="alternate"></link><link href="/feeds/transit.atom.xml" rel="self"></link><id>/</id><updated>2021-04-01T00:00:00-07:00</updated><subtitle>Thoughts on planetary science, fluid dynamics, transit, and scientific computing</subtitle><entry><title>The Population of Vermont</title><link href="/vermont-population.html" rel="alternate"></link><published>2021-04-01T00:00:00-07:00</published><updated>2021-04-01T00:00:00-07:00</updated><author><name>Ian Rose</name></author><id>tag:None,2021-04-01:/vermont-population.html</id><summary type="html">&lt;p&gt;&lt;img alt="oakland" src="/articles/transit/images/vermont.png"&gt;&lt;/p&gt;</summary><content type="html">&lt;script src="https://cdn.jsdelivr.net/npm/vega@5"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/vega-lite@4"&gt;&lt;/script&gt;
&lt;script src="https://cdn.jsdelivr.net/npm/vega-embed@6"&gt;&lt;/script&gt;

&lt;style&gt;
form.vega-bindings {
  position: absolute;
  right: 0px;
  bottom: 0px;
}

#view {
  float: right;
  margin-left: 1em;
  margin-bottom: 3em;
}

&lt;/style&gt;
&lt;div id="view"&gt;&lt;/div&gt;
&lt;script&gt;
  vegaEmbed(
    '#view',
    '/articles/transit/images/vermont.json'
  );
&lt;/script&gt;

&lt;p&gt;There has been a lot of chatter recently about the indefensible malapportionment of the United States Senate.
A senator from small, rural states like Wyoming, Montana, or Vermont,
has exactly the same voting power as a senator from large, urban states like California or New York,
leaving the citizens of those larger states enormously disenfranchised.&lt;/p&gt;
&lt;p&gt;Ruminating on this in Los Angeles County (larger than most states), I had a question:
do more people live along the Vermont Avenue corridor
(one of the largest, most important boulevards in the county, with a subway, good food, and cultural landmarks),
or the state of Vermont, &lt;a href="https://www.census.gov/quickfacts/fact/table/VT/PST045219"&gt;population 623,989&lt;/a&gt;
(has a high-profile senator, but is otherwise not particularly economically important)?&lt;/p&gt;
&lt;p&gt;So I put together this quick visualization using
&lt;a href="https://geohub.lacity.org/datasets/lacounty::2010-census-data-by-block"&gt;Census block population data&lt;/a&gt;
and &lt;a href="https://download.geofabrik.de/north-america/us/california/"&gt;street data&lt;/a&gt; from Open Street Map (OSM).
The answer to the above question depends on what you mean by the "Vermont Avenue corridor":&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If the corridor is defined to be strictly within a city block of Vermont Avenue, which I have approximated by census blocks, then Vermont state has a higher population.&lt;/li&gt;
&lt;li&gt;If the corridor is defined to be within a mile of Vermont Avenue, which is a reasonable walkshed for transit and commerce purposes, then Vermont Avenue has a higher population.&lt;/li&gt;
&lt;li&gt;Vermont Avenue starts to win when you include people living up to three-quarters of a mile from the street.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a coda, I wonder if there are any other major boulevards in the US that are named after states
and have higher populations than their namesake. I could not come up with one myself.&lt;/p&gt;</content></entry><entry><title>Is the Rowena Road Diet a Safety Improvement? (yes)</title><link href="/is-the-rowena-road-diet-a-safety-improvement-yes.html" rel="alternate"></link><published>2019-09-07T00:00:00-07:00</published><updated>2019-09-07T00:00:00-07:00</updated><author><name>Ian Rose</name></author><id>tag:None,2019-09-07:/is-the-rowena-road-diet-a-safety-improvement-yes.html</id><summary type="html">&lt;p&gt;&lt;img alt="rowena-after" src="/articles/transit/images/rowena-after.png"&gt;&lt;/p&gt;</summary><content type="html">&lt;style type="text/css"&gt;/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI escape sequences */
/* The color values are a mix of
   http://www.xcolors.net/dl/baskerville-ivorylight and
   http://www.xcolors.net/dl/euphrasia */
.ansi-black-fg {
  color: #3E424D;
}
.ansi-black-bg {
  background-color: #3E424D;
}
.ansi-black-intense-fg {
  color: #282C36;
}
.ansi-black-intense-bg {
  background-color: #282C36;
}
.ansi-red-fg {
  color: #E75C58;
}
.ansi-red-bg {
  background-color: #E75C58;
}
.ansi-red-intense-fg {
  color: #B22B31;
}
.ansi-red-intense-bg {
  background-color: #B22B31;
}
.ansi-green-fg {
  color: #00A250;
}
.ansi-green-bg {
  background-color: #00A250;
}
.ansi-green-intense-fg {
  color: #007427;
}
.ansi-green-intense-bg {
  background-color: #007427;
}
.ansi-yellow-fg {
  color: #DDB62B;
}
.ansi-yellow-bg {
  background-color: #DDB62B;
}
.ansi-yellow-intense-fg {
  color: #B27D12;
}
.ansi-yellow-intense-bg {
  background-color: #B27D12;
}
.ansi-blue-fg {
  color: #208FFB;
}
.ansi-blue-bg {
  background-color: #208FFB;
}
.ansi-blue-intense-fg {
  color: #0065CA;
}
.ansi-blue-intense-bg {
  background-color: #0065CA;
}
.ansi-magenta-fg {
  color: #D160C4;
}
.ansi-magenta-bg {
  background-color: #D160C4;
}
.ansi-magenta-intense-fg {
  color: #A03196;
}
.ansi-magenta-intense-bg {
  background-color: #A03196;
}
.ansi-cyan-fg {
  color: #60C6C8;
}
.ansi-cyan-bg {
  background-color: #60C6C8;
}
.ansi-cyan-intense-fg {
  color: #258F8F;
}
.ansi-cyan-intense-bg {
  background-color: #258F8F;
}
.ansi-white-fg {
  color: #C5C1B4;
}
.ansi-white-bg {
  background-color: #C5C1B4;
}
.ansi-white-intense-fg {
  color: #A1A6B2;
}
.ansi-white-intense-bg {
  background-color: #A1A6B2;
}
.ansi-default-inverse-fg {
  color: #FFFFFF;
}
.ansi-default-inverse-bg {
  background-color: #000000;
}
.ansi-bold {
  font-weight: bold;
}
.ansi-underline {
  text-decoration: underline;
}
/* The following styles are deprecated an will be removed in a future version */
.ansibold {
  font-weight: bold;
}
.ansi-inverse {
  outline: 0.5px dotted;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  position: relative;
  overflow: visible;
}
div.cell:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: transparent;
}
div.cell.jupyter-soft-selected {
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected,
div.cell.selected.jupyter-soft-selected {
  border-color: #ababab;
}
div.cell.selected:before,
div.cell.selected.jupyter-soft-selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #42A5F5;
}
@media print {
  div.cell.selected,
  div.cell.selected.jupyter-soft-selected {
    border-color: transparent;
  }
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
}
.edit_mode div.cell.selected:before {
  position: absolute;
  display: block;
  top: -1px;
  left: -1px;
  width: 5px;
  height: calc(100% +  2px);
  content: '';
  background: #66BB6A;
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell &gt; div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area &gt; div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area &gt; div.highlight &gt; pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the &lt;head&gt; if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  /* Note that this should set vertical padding only, since CodeMirror assumes
       that horizontal padding will be set on CodeMirror pre */
  padding: 0.4em 0;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. This sets horizontal padding only,
    use .CodeMirror-lines for vertical */
  padding: 0 0.4em;
  border: 0;
  border-radius: 0;
}
.CodeMirror-cursor {
  border-left: 1.4px solid black;
}
@media screen and (min-width: 2138px) and (max-width: 4319px) {
  .CodeMirror-cursor {
    border-left: 2px solid black;
  }
}
@media screen and (min-width: 4320px) {
  .CodeMirror-cursor {
    border-left: 4px solid black;
  }
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev &lt;Maniac@SoftwareManiacs.Org&gt;
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
div.output_area .mglyph &gt; img {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 1px 0 1px 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}
.rendered_html ul:not(.list-inline),
.rendered_html ol:not(.list-inline) {
  padding-left: 2em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}





.rendered_html pre,




.rendered_html tr,
.rendered_html th,


.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,


.rendered_html * + .alert {
  margin-top: 1em;
}
[dir="rtl"] 
div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell &gt; div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.rendered .rendered_html tr,
.text_cell.rendered .rendered_html th,
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.text_cell .dropzone .input_area {
  border: 2px dashed #bababa;
  margin: -1px;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
&lt;/style&gt;
&lt;style type="text/css"&gt;pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */&lt;/style&gt;    &lt;style type="text/css"&gt;

    div.output_area .MathJax_Display {
      text-align: center !important;
    }

    div.output_area {
      justify-content: center;
    }
    &lt;/style&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;In 2012 a pedestrian was struck by a car and killed on Rowena Avenue in Silver Lake,
the neighborhood in Los Angeles where I live.
In 2013 the city put in place a number of safety improvements along that stretch of road,
including reducing the number of car traffic lanes from four to two,
adding bike lanes, and including a center-left-turn lane.
The combination of these changes are termed a "road diet",
intended to slow the flow of traffic and produce less hazardous conditions for users of the road.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;&lt;img src="/articles/transit/images/rowena-before.png" alt="Rownena pre-road-diet" title="Rowena pre-road-diet"&gt;
&lt;img src="/articles/transit/images/rowena-after.png" alt="Rownena post-road-diet" title="Rowena post-road-diet"&gt;&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Anybody who walks around Los Angeles as a pedestrian knows how hostile of an environment it can be,
including in Silver Lake, where cars regularly exceed 40 miles per hour on mixed-use boulevards
like Fountain, Hyperion, Glendale, and Rowena.
Nevertheless, the reconfiguration of Rowena prompted significant backlash among local residents,
who worried about reduced parking, increased congestion, and more cut-through traffic on neighborhood streets.
A similar road diet along Venice Boulevard in Mar Vista led to a threat of a &lt;a href="https://www.latimes.com/local/lanow/la-me-ln-bonin-recall-20170915-story.html"&gt;
recall campaign&lt;/a&gt; of the local city council member.&lt;/p&gt;
&lt;p&gt;Clearly, changes to the streetscape such as the Rowena road diet can inflame the community,
and can effect risks for politicians.
So are road diets worth it? Do they actually provide the safety improvements that they are claimed to do?&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The LA Department of Transportation (LADOT) 
&lt;a href="http://clkrep.lacity.org/onlinedocs/2011/11-2130-s4_rpt_DOT_04-09-2019.pdf"&gt;recently published&lt;/a&gt;
a study on the results of the road diet.
In the study, they claimed that the rate of auto crashes on the relevant stretch of Rowena
dropped by 37%.
This number was obtained by looking at the difference in the average rate of crashes per year
before and after the road reconfiguration.
However, the data are noisy, and there is considerable variability in the number of crashes from year to year.
A road diet skeptic might take a look at the crash statistics and claim there is not enough data,
that the study has not averaged over a sufficiently long time,
and will soon &lt;a href="https://en.wikipedia.org/wiki/Regression_toward_the_mean"&gt;regress to the mean&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here we perform a more in-depth analysis of the limited data included in the LADOT report.
In particular, we will construct a statistical model for crashes along Rowena,
fit it to the observed data, and consider whether it shows a decrease in crashes.&lt;/p&gt;
&lt;p&gt;We will use the Python package PyMC3 to do the modeling, and Altair to make charts.
We begin by importing the Python packages needed for the analysis,
namely Pandas, Altair, and PyMC3.
We also customzize the Altair rendering process to make the charts render more easily on this-here blog:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;altair&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;alt&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pymc3&lt;/span&gt;
&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data_transformers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;disable_max_rows&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;renderers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;enable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;svg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;



&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;RendererRegistry.enable(&amp;#39;svg&amp;#39;)&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Loading-the-data"&gt;Loading the data&lt;a class="anchor-link" href="#Loading-the-data"&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We construct a Pandas dataframe of the crash data by reading the data off of Attachment B in the LADOT report,
and plot it on a bar chart:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;crashes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;year&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2003&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2018&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_bar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;year:O&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;crashes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;


&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg class="marks" width="344" height="360" viewbox="0 0 344 360" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;g transform="translate(39,10)"&gt;&lt;g class="mark-group role-frame root"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0.5,0.5h300v300h-300Z" style="fill: none; stroke: #ddd;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,0.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-grid" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,263)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,225)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,188)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,150)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,113)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,75)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,38)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,0)" x2="300" y2="0" style="fill: none; stroke: #ddd; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-rect role-mark marks"&gt;&lt;path d="M1,112.5h18v187.5h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M21,112.5h18v187.5h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M41,18.75h18v281.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M61,112.5h18v187.5h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M81,56.25h18v243.75h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M101,18.75h18v281.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M121,93.75h18v206.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M141,56.25h18v243.75h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M161,93.75h18v206.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M181,37.5h18v262.5h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M201,168.75h18v131.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M221,75h18v225h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M241,168.75h18v131.25h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M261,150h18v150h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;path d="M281,206.25h18v93.75h-18Z" style="fill: #4c78a8;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,300.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(9,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(29,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(49,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(69,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(89,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(109,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(129,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(149,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(169,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(189,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(209,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(229,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(249,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(269,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(289,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(9,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2003&lt;/text&gt;&lt;text text-anchor="end" transform="translate(29,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2004&lt;/text&gt;&lt;text text-anchor="end" transform="translate(49,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2005&lt;/text&gt;&lt;text text-anchor="end" transform="translate(69,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2006&lt;/text&gt;&lt;text text-anchor="end" transform="translate(89,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2007&lt;/text&gt;&lt;text text-anchor="end" transform="translate(109,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2008&lt;/text&gt;&lt;text text-anchor="end" transform="translate(129,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2009&lt;/text&gt;&lt;text text-anchor="end" transform="translate(149,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2010&lt;/text&gt;&lt;text text-anchor="end" transform="translate(169,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2011&lt;/text&gt;&lt;text text-anchor="end" transform="translate(189,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2012&lt;/text&gt;&lt;text text-anchor="end" transform="translate(209,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2013&lt;/text&gt;&lt;text text-anchor="end" transform="translate(229,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2014&lt;/text&gt;&lt;text text-anchor="end" transform="translate(249,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2015&lt;/text&gt;&lt;text text-anchor="end" transform="translate(269,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2016&lt;/text&gt;&lt;text text-anchor="end" transform="translate(289,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2017&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="300" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(150,42.24609375)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;year&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,0.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,263)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,225)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,188)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,113)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,75)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,38)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,265.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,228)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;4&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,190.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;6&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;8&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,115.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;10&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,78)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;12&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,40.5)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;14&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;16&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(-22.123046875,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;crashes&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;As noted above, it certainly looks like there is a decrease in the number of crashes towards the end of the chart,
but it's difficult to say with certainty. So let's model it.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Bayesian-Markov-Chain-Monte-Carlo-methods."&gt;Bayesian Markov-Chain Monte-Carlo methods.&lt;a class="anchor-link" href="#Bayesian-Markov-Chain-Monte-Carlo-methods."&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;PyMC3 works by constructing a statistical model for generating your data.
It then fits the model by means of Bayesian Markov-Chain Monte-Carlo (MCMC) analysis.
A full explication of MCMC methods is well beyond the scope of this article,
but here is a brief qualitative description of how they work:
A Markov-Chain method describes a process that moves through parameter space,
where the transition to each state depends only on the previous state.
A Monte-Carlo method is a general term for a computational method
where there are many random draws of values in performing the computation
(for a fun example of this, see &lt;a href="https://en.wikipedia.org/wiki/Buffon%27s_needle_problem"&gt;Buffon's needle&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Bayesian MCMC methods typically involve constructing a statistical model with some unknown parameter values.
An MCMC algorithm then explores the space of these possible parameter values,
testing how well each point in parameter space fits the observed data.
They do this by hopping generally towards points of higher probability
(roughly the Markov-chain part), with an element of randomness (roughly the Monte-Carlo part)
so they don't get caught in local maxima.&lt;/p&gt;
&lt;p&gt;As a result of this approach, Bayesian MCMC methods tend to explore not only the best model fit to the data,
but also a broad region around the best fit.
Therefore, they furnish not only an estimate of the best parameter values,
but also an estimate of the uncertainties and tradeoffs.
This estimate of the uncertainty is particularly useful to us in looking at the Rowena road diet.
We are not just interested in how much the rate of crashes has decreased, but how much we can trust that number.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="A-model-for-crashes"&gt;A model for crashes&lt;a class="anchor-link" href="#A-model-for-crashes"&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We will model the rate of crashes along Rowena as a Poisson process.
Poisson processes describe counting statistics which are memory-less.
Events described by a such a process have fixed probability of occurring at any given time,
and these events are statistically independent of each other.
Poisson processes are routinely used to model earthquakes, pedestrian counts,
website traffic, and, indeed, car crashes.&lt;/p&gt;
&lt;p&gt;Now, the features of constant-rates and memorylessness are probably not completely accurate.
Over the last few years, rates of car crashes, especially those involving pedestrians,
have been on a persistent increase in the United States. And over time periods of seconds,
car crashes are certainly not statistically unrelated (crashes beget more crashes).
However, we will assume that bunched crashes on a second-time-scale are considered a single event,
and that local effects on Rowena are more important than longer-term city-wide secular changes,
and therefore move forward with a Poisson process.&lt;/p&gt;
&lt;p&gt;We will consider a model where there is an early rate of collisions,
a later rate of collisions, and a time point at which the rate changes from early to late.
This makes for a three parameter model (early rate, late rate, and change point).&lt;/p&gt;
&lt;p&gt;Bayesian methods require us to define prior distributions for each of the parameters for which we are fitting.
These represent our prior beliefs about the values of the parameters.
Sometimes the need to choose a prior is a cause of some angst for the practitioner,
but I would argue that they provide much of the power and expressiveness of Bayesian methods.
They allow us to build in our understanding of the physics of the model,
and are a natural way to regularize the model, providing a powerful tool against overfitting.&lt;/p&gt;
&lt;p&gt;We will make the following choices for the priors of our three parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For the change point we will assign a uniform prior from 2003 to 2017, indicating that we consider
any point from 2003 to 2017 to be equally likely to contain a change.&lt;/li&gt;
&lt;li&gt;For the rate parameters we will choose exponential distributions.
Exponential distributions are useful for representing strictly positive real number values (as the rate must be),
where very high numbers are less likely than very low number.
Exponential distributions are specified via a scale parameter $\lambda$
(a so-called "hyperparameter" for our model),
which characterizes how quickly the probability density decays.
The mean of an exponential distribution is equal to $1/\lambda$,
so we will use the overall mean of the number of crashes per year on Rowena
to choose the $\lambda$ for our priors on both the early and late rates.&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Constructing-the-model-with-PyMC3"&gt;Constructing the model with PyMC3&lt;a class="anchor-link" href="#Constructing-the-model-with-PyMC3"&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;PyMC3 provides a nice API for constructing statistical models out of our chosen distributions,
including ways of specifying random variables with our chosen prior distributions.
We begin by declaring our rate variables, with $\lambda$ equal to one over the overall mean of the crash rate:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;road_diet_model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;   
    &lt;span class="n"&gt;early_rate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Exponential&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crashes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
    &lt;span class="n"&gt;late_rate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Exponential&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crashes&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Next, we declare the switch point variable with a discrete uniform prior between the years of our dataset:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;road_diet_model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;switchpoint&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DiscreteUniform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;switchpoint&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;lower&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;min&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
        &lt;span class="n"&gt;upper&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We need to stitch together these random variables with a meta-random variable for the overall rate,
which switches from &lt;code&gt;early_rate&lt;/code&gt; to &lt;code&gt;late_rate&lt;/code&gt; after &lt;code&gt;switchpoint&lt;/code&gt;.
This can be accomplished using the pymc utility function &lt;code&gt;switch&lt;/code&gt;:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;road_diet_model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;rate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;switch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;switchpoint&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;early_rate&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;late_rate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;Finally, we need to inform the model of the observed data, which we presume
have been generated using a Poisson process:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;road_diet_model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Poisson&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;crashes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;observed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;crashes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;    
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The &lt;code&gt;observed&lt;/code&gt; argument lets the model know that these are the observations which we are trying to fit,
and it will use those observations when testing how good any particular realization is at describing the data.&lt;/p&gt;
&lt;p&gt;This completes the specification of the statistical model of crashes on Rowena.
All that remains is to conduct the MCMC sampling:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# make pymc a bit less verbose&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;logging&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getLogger&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pymc3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setLevel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;FATAL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;road_diet_model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;trace&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;50000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;progressbar&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The resulting samples from the MCMC algorithm are stored in the &lt;code&gt;trace&lt;/code&gt; object.
We can put those samples in a dataframe for further analysis:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;switchpoint&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;trace&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;switchpoint&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;trace&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;trace&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Interpreting-the-results"&gt;Interpreting the results&lt;a class="anchor-link" href="#Interpreting-the-results"&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;If the model has converged, then resulting samples from the MCMC trace are representative of the model's posterior distribution.
Descriptive statistics and plots can therefore give us insight into our beliefs about the random variables.&lt;/p&gt;
&lt;p&gt;The first question we want to ask is: did the rate of collisions actually change, and if so, by how much?
The following histogram of our rate samples shows whether we should consider the rate to have changed:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;late_rate&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;early_rate&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;transform_fold&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_area&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;interpolate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;step&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;value:Q&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Crashes/year&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Bin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.25&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;count()&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Number of Samples&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;key:N&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Scale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scheme&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;set1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure_axis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;


&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg class="marks" width="542" height="347" viewbox="0 0 542 347" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;defs&gt;&lt;clippath id="clip1"&gt;&lt;rect x="0" y="0" width="400" height="300"&gt;&lt;/rect&gt;&lt;/clippath&gt;&lt;clippath id="clip2"&gt;&lt;rect x="0" y="0" width="400" height="300"&gt;&lt;/rect&gt;&lt;/clippath&gt;&lt;/defs&gt;&lt;g transform="translate(58,10)"&gt;&lt;g class="mark-group role-frame root"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0.5,0.5h400v300h-400Z" style="fill: none; stroke: #ddd;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-group role-scope pathgroup"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0,0h400v300h-400Z" style="fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-area role-mark marks" clip-path="url(#clip1)"&gt;&lt;path d="M397.5,299.35L395,299.35L395,299.48333333333335L390,299.48333333333335L390,299.28333333333336L385,299.28333333333336L385,299.1666666666667L380,299.1666666666667L380,299.45L375,299.45L375,299.28333333333336L370,299.28333333333336L370,299.0833333333333L365,299.0833333333333L365,299.06666666666666L360,299.06666666666666L360,299.26666666666665L355,299.26666666666665L355,299.26666666666665L350,299.26666666666665L350,299.35L345,299.35L345,299.05L340,299.05L340,299.18333333333334L335,299.18333333333334L335,299.18333333333334L330,299.18333333333334L330,299.3833333333333L325,299.3833333333333L325,299.1166666666667L320,299.1166666666667L320,299.01666666666665L315,299.01666666666665L315,299.01666666666665L310,299.01666666666665L310,298.75L305,298.75L305,298.8L300,298.8L300,298.9L295,298.9L295,298.68333333333334L290,298.68333333333334L290,298.5833333333333L285,298.5833333333333L285,298.73333333333335L280,298.73333333333335L280,298.8333333333333L275,298.8333333333333L275,298.3L270,298.3L270,297.8L265,297.8L265,296.51666666666665L260,296.51666666666665L260,295.35L255,295.35L255,295.23333333333335L250,295.23333333333335L250,292.05L245,292.05L245,289.3L240,289.3L240,284.96666666666664L235,284.96666666666664L235,278.01666666666665L230,278.01666666666665L230,272.5333333333333L225,272.5333333333333L225,263.68333333333334L220,263.68333333333334L220,252.96666666666667L215,252.96666666666667L215,245.78333333333333L210,245.78333333333333L210,238.81666666666666L205,238.81666666666666L205,228.93333333333334L200,228.93333333333334L200,220.56666666666666L195,220.56666666666666L195,209.96666666666667L190,209.96666666666667L190,200.16666666666669L185,200.16666666666669L185,192.8L180,192.8L180,181.38333333333333L175,181.38333333333333L175,171.48333333333335L170,171.48333333333335L170,163.78333333333333L165,163.78333333333333L165,152.76666666666668L160,152.76666666666668L160,146.5L155,146.5L155,146.61666666666665L150,146.61666666666665L150,140.76666666666665L145,140.76666666666665L145,143.11666666666667L140,143.11666666666667L140,147.78333333333333L135,147.78333333333333L135,153.76666666666665L130,153.76666666666665L130,160.36666666666667L125,160.36666666666667L125,172.13333333333333L120,172.13333333333333L120,182.08333333333334L115,182.08333333333334L115,195.26666666666665L110,195.26666666666665L110,207.13333333333333L105,207.13333333333333L105,218.01666666666665L100,218.01666666666665L100,231.03333333333333L95,231.03333333333333L95,240.98333333333335L90,240.98333333333335L90,251L85,251L85,259.06666666666666L80,259.06666666666666L80,265.1666666666667L75,265.1666666666667L75,271.28333333333336L70,271.28333333333336L70,275.01666666666665L65,275.01666666666665L65,279.1166666666667L60,279.1166666666667L60,282.9166666666667L55,282.9166666666667L55,285.35L50,285.35L50,288.23333333333335L45,288.23333333333335L45,290.6166666666667L40,290.6166666666667L40,292L35,292L35,293.35L30,293.35L30,294.78333333333336L25,294.78333333333336L25,295.9166666666667L20,295.9166666666667L20,295.9L15,295.9L15,296.3333333333333L10,296.3333333333333L10,295.25L5,295.25L5,295.28333333333336L2.5,295.28333333333336L2.5,300L5,300L5,300L10,300L10,300L15,300L15,300L20,300L20,300L25,300L25,300L30,300L30,300L35,300L35,300L40,300L40,300L45,300L45,300L50,300L50,300L55,300L55,300L60,300L60,300L65,300L65,300L70,300L70,300L75,300L75,300L80,300L80,300L85,300L85,300L90,300L90,300L95,300L95,300L100,300L100,300L105,300L105,300L110,300L110,300L115,300L115,300L120,300L120,300L125,300L125,300L130,300L130,300L135,300L135,300L140,300L140,300L145,300L145,300L150,300L150,300L155,300L155,300L160,300L160,300L165,300L165,300L170,300L170,300L175,300L175,300L180,300L180,300L185,300L185,300L190,300L190,300L195,300L195,300L200,300L200,300L205,300L205,300L210,300L210,300L215,300L215,300L220,300L220,300L225,300L225,300L230,300L230,300L235,300L235,300L240,300L240,300L245,300L245,300L250,300L250,300L255,300L255,300L260,300L260,300L265,300L265,300L270,300L270,300L275,300L275,300L280,300L280,300L285,300L285,300L290,300L290,300L295,300L295,300L300,300L300,300L305,300L305,300L310,300L310,300L315,300L315,300L320,300L320,300L325,300L325,300L330,300L330,300L335,300L335,300L340,300L340,300L345,300L345,300L350,300L350,300L355,300L355,300L360,300L360,300L365,300L365,300L370,300L370,300L375,300L375,300L380,300L380,300L385,300L385,300L390,300L390,300L395,300L395,300L397.5,300Z" style="fill: #377eb8; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0,0h400v300h-400Z" style="fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-area role-mark marks" clip-path="url(#clip2)"&gt;&lt;path d="M397.5,299.95L392.5,299.95L392.5,299.8333333333333L385,299.8333333333333L385,299.98333333333335L375,299.98333333333335L375,299.81666666666666L365,299.81666666666666L365,299.73333333333335L360,299.73333333333335L360,299.93333333333334L355,299.93333333333334L355,299.9166666666667L350,299.9166666666667L350,299.6166666666667L345,299.6166666666667L345,299.73333333333335L340,299.73333333333335L340,299.8666666666667L335,299.8666666666667L335,299.65L330,299.65L330,299.31666666666666L325,299.31666666666666L325,299.28333333333336L320,299.28333333333336L320,298.4166666666667L315,298.4166666666667L315,297.3833333333333L310,297.3833333333333L310,296.0833333333333L305,296.0833333333333L305,293.8833333333333L300,293.8833333333333L300,290.55L295,290.55L295,284.6333333333333L290,284.6333333333333L290,277.95L285,277.95L285,267.8333333333333L280,267.8333333333333L280,254.18333333333334L275,254.18333333333334L275,233.43333333333334L270,233.43333333333334L270,212.78333333333333L265,212.78333333333333L265,184.55L260,184.55L260,150.9L255,150.9L255,110.73333333333332L250,110.73333333333332L250,73.43333333333334L245,73.43333333333334L245,45.06666666666666L240,45.06666666666666L240,19.01666666666671L235,19.01666666666671L235,8.100000000000023L230,8.100000000000023L230,13.633333333333326L225,13.633333333333326L225,25.48333333333335L220,25.48333333333335L220,59.98333333333335L215,59.98333333333335L215,96.56666666666666L210,96.56666666666666L210,143.41666666666666L205,143.41666666666666L205,188.53333333333336L200,188.53333333333336L200,222.10000000000002L195,222.10000000000002L195,249.95L190,249.95L190,268.73333333333335L185,268.73333333333335L185,281.76666666666665L180,281.76666666666665L180,289.8833333333333L175,289.8833333333333L175,292.65L170,292.65L170,294.55L165,294.55L165,295.96666666666664L160,295.96666666666664L160,296.5L155,296.5L155,296.6333333333333L150,296.6333333333333L150,297.46666666666664L145,297.46666666666664L145,297.95L140,297.95L140,297.56666666666666L135,297.56666666666666L135,298L130,298L130,297.6166666666667L125,297.6166666666667L125,298.23333333333335L120,298.23333333333335L120,299.6333333333333L115,299.6333333333333L115,299.1166666666667L110,299.1166666666667L110,299.5833333333333L105,299.5833333333333L105,298.98333333333335L100,298.98333333333335L100,299.75L95,299.75L95,299.95L90,299.95L90,298.96666666666664L85,298.96666666666664L85,299.6L80,299.6L80,299.35L75,299.35L75,299.81666666666666L70,299.81666666666666L70,299.68333333333334L65,299.68333333333334L65,299.55L60,299.55L60,299.8666666666667L57.49999999999999,299.8666666666667L57.49999999999999,300L60,300L60,300L65,300L65,300L70,300L70,300L75,300L75,300L80,300L80,300L85,300L85,300L90,300L90,300L95,300L95,300L100,300L100,300L105,300L105,300L110,300L110,300L115,300L115,300L120,300L120,300L125,300L125,300L130,300L130,300L135,300L135,300L140,300L140,300L145,300L145,300L150,300L150,300L155,300L155,300L160,300L160,300L165,300L165,300L170,300L170,300L175,300L175,300L180,300L180,300L185,300L185,300L190,300L190,300L195,300L195,300L200,300L200,300L205,300L205,300L210,300L210,300L215,300L215,300L220,300L220,300L225,300L225,300L230,300L230,300L235,300L235,300L240,300L240,300L245,300L245,300L250,300L250,300L255,300L255,300L260,300L260,300L265,300L265,300L270,300L270,300L275,300L275,300L280,300L280,300L285,300L285,300L290,300L290,300L295,300L295,300L300,300L300,300L305,300L305,300L310,300L310,300L315,300L315,300L320,300L320,300L325,300L325,300L330,300L330,300L335,300L335,300L340,300L340,300L345,300L345,300L350,300L350,300L355,300L355,300L360,300L360,300L365,300L365,300L375,300L375,300L385,300L385,300L392.5,300L392.5,300L397.5,300Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-legend"&gt;&lt;g transform="translate(418,0)"&gt;&lt;path class="background" d="M0,0h61v40h-61Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-group role-legend-entry"&gt;&lt;g transform="translate(0,16)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-group role-scope"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0,0h60.4677734375v11h-60.4677734375Z" style="pointer-events: none; fill: none; opacity: 1;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-symbol role-legend-symbol" style="pointer-events: none;"&gt;&lt;path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" style="fill: #e41a1c; stroke-width: 1.5; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;g class="mark-text role-legend-label" style="pointer-events: none;"&gt;&lt;text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;early_rate&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g transform="translate(0,13)"&gt;&lt;path class="background" d="M0,0h60.4677734375v11h-60.4677734375Z" style="pointer-events: none; fill: none; opacity: 1;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-symbol role-legend-symbol" style="pointer-events: none;"&gt;&lt;path transform="translate(6,6)" d="M5,0A5,5,0,1,1,-5,0A5,5,0,1,1,5,0" style="fill: #377eb8; stroke-width: 1.5; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;g class="mark-text role-legend-label" style="pointer-events: none;"&gt;&lt;text text-anchor="start" transform="translate(16,9)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;late_rate&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-text role-legend-title" style="pointer-events: none;"&gt;&lt;text text-anchor="start" transform="translate(0,9)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;key&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,300.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(10,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(20,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(30,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(40,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(60,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(70,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(80,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(90,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(100,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(110,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(120,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(130,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(140,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(150,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(160,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(170,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(180,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(190,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(200,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(210,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(220,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(230,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(240,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(250,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(260,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(270,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(280,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(290,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(300,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(310,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(320,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(330,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(340,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(350,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(360,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(370,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(380,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(390,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(400,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="start" transform="translate(0,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(10,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;0.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(20,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;1.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(30,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;1.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(40,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(50,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;2.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(60,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;3.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(70,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;3.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(80,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;4.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(90,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;4.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(100,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;5.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(110.00000000000001,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;5.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(120,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;6.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(130,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;6.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(140,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;7.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(150,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;7.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(160,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;8.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(170,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;8.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(180,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;9.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(190,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;9.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(200,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;10.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(210,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;10.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(220.00000000000003,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;11.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(229.99999999999997,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;11.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(240,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;12.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(250,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;12.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(260,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;13.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(270,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;13.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(280,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;14.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(290,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;14.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(300,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;15.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(310,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;15.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(320,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;16.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(330,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;16.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(340,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;17.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(350,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;17.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(360,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;18.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(370,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;18.5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(380,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;19.0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(390,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;19.5&lt;/text&gt;&lt;text text-anchor="end" transform="translate(400,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;20.0&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="400" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(200,30)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Crashes/year&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,0.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,267)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,233)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,200)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,167)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,133)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,100)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,67)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,33)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,269.6666666666667)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,236.33333333333334)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;4,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,203)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;6,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,169.66666666666669)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;8,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,136.33333333333331)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;10,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,103)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;12,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,69.66666666666666)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;14,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,36.33333333333337)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;16,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;18,000&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(-41.5859375,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Number of Samples&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;As described in the LADOT report, the later rate of crashes appears to be significantly less than the early rate.
The early rate peaks at around twelve crashes per year, and the later rate peaks at around seven crashes per year.
However, there is a fair amount uncertainty in the value of each of them, and there is some overlap.
So while it seems likely that there was a drop, it is not a certainty.&lt;/p&gt;
&lt;p&gt;From these samples we can also calculate the mean and standard deviations of the posteriors:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;IPython.display&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Latex&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Latex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Early Rate: $&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\pm  &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;early_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;$ crashes/yr&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Latex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Later Rate: $&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\pm  &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;late_rate&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;$ crashes/yr&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;



&lt;div class="output_latex output_subarea "&gt;
Early Rate: $11.6 \pm  1.3$ crashes/yr
&lt;/div&gt;

&lt;/div&gt;

&lt;div class="output_area"&gt;



&lt;div class="output_latex output_subarea "&gt;
Later Rate: $7.6 \pm  3.2$ crashes/yr
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;We are also interested in the posterior distribution for the change point:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_bar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;interpolate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;step&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;switchpoint:O&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Change point&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;count()&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Number of Samples&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;key:N&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Scale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scheme&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;set1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure_axis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;


&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg class="marks" width="363" height="360" viewbox="0 0 363 360" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;defs&gt;&lt;clippath id="clip1"&gt;&lt;rect x="0" y="0" width="300" height="300"&gt;&lt;/rect&gt;&lt;/clippath&gt;&lt;/defs&gt;&lt;g transform="translate(58,10)"&gt;&lt;g class="mark-group role-frame root"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0.5,0.5h300v300h-300Z" style="fill: none; stroke: #ddd;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rect role-mark marks" clip-path="url(#clip1)"&gt;&lt;path d="M201,224.84727272727272h18v75.15272727272728h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M101,278.59090909090907h18v21.409090909090935h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M121,278.7218181818182h18v21.278181818181793h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M181,81.31090909090909h18v218.6890909090909h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M161,251.64545454545456h18v48.354545454545445h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M241,178.55454545454546h18v121.44545454545454h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M261,162.6109090909091h18v137.3890909090909h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M221,11.612727272727284h18v288.3872727272727h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M61,290.34h18v9.660000000000025h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M21,287.2090909090909h18v12.79090909090911h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M81,289.09090909090907h18v10.909090909090935h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M1,282.23454545454547h18v17.76545454545453h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M141,260.14363636363635h18v39.85636363636365h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M281,243.34363636363636h18v56.656363636363636h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;path d="M41,288.83454545454543h18v11.165454545454566h-18Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,300.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(9,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(29,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(49,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(69,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(89,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(109,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(129,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(149,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(169,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(189,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(209,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(229,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(249,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(269,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(289,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(9,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2003&lt;/text&gt;&lt;text text-anchor="end" transform="translate(29,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2004&lt;/text&gt;&lt;text text-anchor="end" transform="translate(49,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2005&lt;/text&gt;&lt;text text-anchor="end" transform="translate(69,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2006&lt;/text&gt;&lt;text text-anchor="end" transform="translate(89,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2007&lt;/text&gt;&lt;text text-anchor="end" transform="translate(109,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2008&lt;/text&gt;&lt;text text-anchor="end" transform="translate(129,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2009&lt;/text&gt;&lt;text text-anchor="end" transform="translate(149,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2010&lt;/text&gt;&lt;text text-anchor="end" transform="translate(169,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2011&lt;/text&gt;&lt;text text-anchor="end" transform="translate(189,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2012&lt;/text&gt;&lt;text text-anchor="end" transform="translate(209,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2013&lt;/text&gt;&lt;text text-anchor="end" transform="translate(229,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2014&lt;/text&gt;&lt;text text-anchor="end" transform="translate(249,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2015&lt;/text&gt;&lt;text text-anchor="end" transform="translate(269,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2016&lt;/text&gt;&lt;text text-anchor="end" transform="translate(289,7) rotate(270) translate(0,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2017&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="300" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(150,42.24609375)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Change point&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,0.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,273)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,245)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,218)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,191)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,164)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,136)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,109)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,82)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,55)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,27)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,275.72727272727275)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;5,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,248.45454545454544)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;10,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,221.1818181818182)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;15,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,193.9090909090909)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;20,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,166.63636363636365)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;25,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,139.36363636363637)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;30,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,112.0909090909091)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;35,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,84.81818181818181)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;40,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,57.54545454545453)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;45,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,30.27272727272731)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;50,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;55,000&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(-41.5859375,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Number of Samples&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;There is considerable uncertainty in when the posterior distribution for the change point,
though the great majority of the probability density is in the latter portion of the time interval.
The most likely year for the rates to have switched is 2014, the year after the road diet was enacted.&lt;/p&gt;
&lt;p&gt;Finally, we would like to see if we can reproduce the top-line number from the LADOT report:
by how much has the rate of crashes changed?
And what is the uncertainty in that number?&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;rate_diff&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;early_rate&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;late_rate&lt;/span&gt;
&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;change&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rate_diff&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;early_rate&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;

&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;change&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_area&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;opacity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;interpolate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;step&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;X&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;change:Q&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Percent Change&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Bin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;step&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
    &lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Y&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;count()&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Samples&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Color&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;key:N&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;alt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Scale&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scheme&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;set1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;configure_axis&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;


&lt;div class="output_svg output_subarea output_execute_result"&gt;
&lt;svg class="marks" width="464" height="347" viewbox="0 0 464 347" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;&lt;defs&gt;&lt;clippath id="clip1"&gt;&lt;rect x="0" y="0" width="400" height="300"&gt;&lt;/rect&gt;&lt;/clippath&gt;&lt;/defs&gt;&lt;g transform="translate(58,10)"&gt;&lt;g class="mark-group role-frame root"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0.5,0.5h400v300h-400Z" style="fill: none; stroke: #ddd;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-group role-scope pathgroup"&gt;&lt;g transform="translate(0,0)"&gt;&lt;path class="background" d="M0,0h400v300h-400Z" style="fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-area role-mark marks" clip-path="url(#clip1)"&gt;&lt;path d="M395,298.85L390,298.85L390,298.925L380,298.925L380,298.8375L370,298.8375L370,298.2375L360,298.2375L360,297.7L350,297.7L350,297.675L340,297.675L340,298.55L330,298.55L330,297.325L320,297.325L320,297.6L310,297.6L310,296.7125L300,296.7125L300,296.4375L290,296.4375L290,295.55L280,295.55L280,294.6125L270,294.6125L270,294.8L260,294.8L260,293.7875L250,293.7875L250,291.7375L240,291.7375L240,289.2L230,289.2L230,286.1125L220,286.1125L220,279.2L210,279.2L210,269.55L200,269.55L200,257.1L190,257.1L190,235.46249999999998L180,235.46249999999998L180,207.7L170,207.7L170,165.9375L160,165.9375L160,126.4L150,126.4L150,79.975L140,79.975L140,38.375L130,38.375L130,22.61250000000001L120,22.61250000000001L120,26.724999999999966L110,26.724999999999966L110,59.80000000000001L100,59.80000000000001L100,108.51249999999999L90,108.51249999999999L90,163.1375L80,163.1375L80,211.05L70,211.05L70,243.2625L60,243.2625L60,263.9625L50,263.9625L50,277.25L40,277.25L40,285.4625L30,285.4625L30,291.3875L20,291.3875L20,293.7375L10,293.7375L10,292.375L5,292.375L5,300L10,300L10,300L20,300L20,300L30,300L30,300L40,300L40,300L50,300L50,300L60,300L60,300L70,300L70,300L80,300L80,300L90,300L90,300L100,300L100,300L110,300L110,300L120,300L120,300L130,300L130,300L140,300L140,300L150,300L150,300L160,300L160,300L170,300L170,300L180,300L180,300L190,300L190,300L200,300L200,300L210,300L210,300L220,300L220,300L230,300L230,300L240,300L240,300L250,300L250,300L260,300L260,300L270,300L270,300L280,300L280,300L290,300L290,300L300,300L300,300L310,300L310,300L320,300L320,300L330,300L330,300L340,300L340,300L350,300L350,300L360,300L360,300L370,300L370,300L380,300L380,300L390,300L390,300L395,300Z" style="fill: #e41a1c; opacity: 0.6;"&gt;&lt;/path&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,300.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(10,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(20,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(30,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(40,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(50,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(60,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(70,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(80,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(90,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(100,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(110,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(120,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(130,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(140,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(150,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(160,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(170,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(180,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(190,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(200,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(210,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(220,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(230,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(240,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(250,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(260,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(270,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(280,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(290,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(300,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(310,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(320,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(330,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(340,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(350,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(360,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(370,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(380,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(390,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(400,0)" x2="0" y2="5" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="start" transform="translate(0,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;-100&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(10,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-95&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(20,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-90&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(30,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-85&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(40,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;-80&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(50,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-75&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(60,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-70&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(70,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-65&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(80,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;-60&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(90,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-55&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(100,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-50&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(110.00000000000001,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-45&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(120,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;-40&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(130,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-35&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(140,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-30&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(150,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-25&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(160,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;-20&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(170,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-15&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(180,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-10&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(190,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;-5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(200,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(210,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;5&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(220.00000000000003,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;10&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(229.99999999999997,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;15&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(240,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;20&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(250,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;25&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(260,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;30&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(270,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;35&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(280,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;40&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(290,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;45&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(300,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;50&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(310,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;55&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(320,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;60&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(330,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;65&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(340,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;70&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(350,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;75&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(360,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;80&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(370,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;85&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(380,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;90&lt;/text&gt;&lt;text text-anchor="middle" transform="translate(390,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 0;"&gt;95&lt;/text&gt;&lt;text text-anchor="end" transform="translate(400,15)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;100&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,0)" x2="400" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(200,30)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Percent Change&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;g class="mark-group role-axis"&gt;&lt;g transform="translate(0.5,0.5)"&gt;&lt;path class="background" d="M0,0h0v0h0Z" style="pointer-events: none; fill: none;"&gt;&lt;/path&gt;&lt;g&gt;&lt;g class="mark-rule role-axis-tick" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,275)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,250)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,225)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,200)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,175)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,150)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,125)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,100)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,75)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,50)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,25)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;line transform="translate(0,0)" x2="-5" y2="0" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-label" style="pointer-events: none;"&gt;&lt;text text-anchor="end" transform="translate(-7,303)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;0&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,278)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;2,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,253)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;4,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,228)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;6,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,203)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;8,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,178)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;10,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,153)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;12,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,128)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;14,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,103)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;16,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,78)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;18,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,53)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;20,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,28)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;22,000&lt;/text&gt;&lt;text text-anchor="end" transform="translate(-7,3)" style="font-family: sans-serif; font-size: 10px; fill: #000; opacity: 1;"&gt;24,000&lt;/text&gt;&lt;/g&gt;&lt;g class="mark-rule role-axis-domain" style="pointer-events: none;"&gt;&lt;line transform="translate(0,300)" x2="0" y2="-300" style="fill: none; stroke: #888; stroke-width: 1; opacity: 1;"&gt;&lt;/line&gt;&lt;/g&gt;&lt;g class="mark-text role-axis-title" style="pointer-events: none;"&gt;&lt;text text-anchor="middle" transform="translate(-41.5859375,150) rotate(-90) translate(0,-2)" style="font-family: sans-serif; font-size: 11px; font-weight: bold; fill: #000; opacity: 1;"&gt;Samples&lt;/text&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/g&gt;&lt;/svg&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;The change in the rate of crashes is given by:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Latex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Percent change in crashes/yr: $&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;change&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;
    &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\pm  &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;change&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;.1f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\%$ &amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;



&lt;div class="output_latex output_subarea output_execute_result"&gt;
Percent change in crashes/yr: $-33.5 \pm  32.0\%$ 
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;This is a pretty sizable decrease, and fairly close to the LADOT figure!
The uncertainty, on the value is large, however, so I would be hesitant to report it to too many digits.&lt;/p&gt;
&lt;p&gt;Finally, we can compute a 95% credible interval for the percent change,
indicating the bounds beween which 95% of the samples fell:&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;

&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;hpd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pymc3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hpd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;trace_df&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;change&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Latex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;95% credible interval for percent change: $ &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;hpd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\%, \, &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;hpd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\%  $&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

    &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;

&lt;div class="output_area"&gt;



&lt;div class="output_latex output_subarea output_execute_result"&gt;
95% credible interval for percent change: $ -82.18553638451415\%, \, 11.224291937160935\%  $
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;This indicates that the great majority of the posterior shows an overall decrease in the rate of crashes.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Conclusions"&gt;Conclusions&lt;a class="anchor-link" href="#Conclusions"&gt;&amp;#182;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The results of this analysis are roughly consistent with that of the LADOT report.
There was a significant decrease in the rate of collisions on the order of 30%,
and that decrease roughly coincides with the installation of the road diet.
And all this occurred during a period of
&lt;a href="https://www.latimes.com/local/lanow/la-me-ln-traffic-deaths-bike-pedestrian-los-angeles-vision-zero-20190425-story.html"&gt;increasing pedestrian fatalities&lt;/a&gt;,
both locally and nationally.&lt;/p&gt;
&lt;p&gt;There remains significant uncertainties on exactly by how much it has decreased.
However, these are not a bad thing!
The uncertainties are largely due to length of the elapsed time since the road diet was installed:
there has not really been enough time to say with absolute confidence that the road has a lower rate of crashes.
As time goes on, and more crash data is collected, we will be able to have more confidence in our conclusions.
But when lives are at stake, it's worthwhile to conduct such analyses as soon as feasible, and often thereafter.&lt;/p&gt;
&lt;p&gt;The council member for the neighborhood has since
&lt;a href="https://la.curbed.com/2019/5/17/18629671/rowena-avenue-road-diet-silver-lake-bike-lanes"&gt;announced his support&lt;/a&gt;
for the road diet, and it seems that it is likely to stay.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
 


&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;
</content></entry><entry><title>Airport Walking</title><link href="/airport-walking.html" rel="alternate"></link><published>2018-08-18T00:00:00-07:00</published><updated>2018-08-18T00:00:00-07:00</updated><author><name>Ian Rose</name></author><id>tag:None,2018-08-18:/airport-walking.html</id><summary type="html">&lt;p&gt;&lt;img alt="oakland" src="/articles/transit/images/oakland.jpg"&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I like to walk places (a lot). I also prefer to avoid taking taxis or ridesharing services.
At some point in college, I found myself at the Tweed New Haven airport
at an odd hour, and decided to try my hand at walking downtown rather than
taking a cab.  I found that it was surprisingly pleasant, and the distance
was not outlandish.&lt;/p&gt;
&lt;p&gt;From then on I have had a quasi-hobby of walking to/from the various
airports that I fly. The general goal is to go between the terminals
and the downtown of whatever city the airport serves (though I will
bend those rules if convenient). Sometimes the walk is fun, sometimes
it is unpleasant, but it always takes me through different parts of the city
than most visitors usually see.&lt;/p&gt;
&lt;p&gt;Here are a few tips for having a successful airport walk:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Keep the weather and time-of-day in mind.&lt;/li&gt;
&lt;li&gt;Travel with only a backpack as luggage.&lt;/li&gt;
&lt;li&gt;Usually the most dangerous part is the road network around the airport itself.&lt;/li&gt;
&lt;li&gt;If you walk from an airport, nobody has to sit next to you on the plane afterwards.&lt;/li&gt;
&lt;li&gt;Plot out a rough route beforehand.&lt;/li&gt;
&lt;li&gt;It's worth it to take a less direct route in order to avoid highways and arterials.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This post is intended to keep a record of the airports from/to which I have walked,
as well as some reviews, in case anybody reading this wants to give it a shot!
I will try to keep this list up to date as I collect more airports.
There is some low-hanging-fruit out there (looking at you, Burbank,
Las Vegas, and San Diego).&lt;/p&gt;
&lt;h2&gt;New Haven&lt;/h2&gt;
&lt;p&gt;As noted, this is the first airport I walked from.
This was a fairly short and pleasant, with low hills and a couple of bridges.
It also passed through
&lt;a href="https://en.wikipedia.org/wiki/Wooster_Square"&gt;Wooster Square&lt;/a&gt;,
home of the &lt;a href="https://en.wikipedia.org/wiki/Sally%27s_Apizza"&gt;best pizza&lt;/a&gt; to be found anywhere.&lt;/p&gt;
&lt;h5&gt;Distance: 5 miles&lt;/h5&gt;
&lt;h5&gt;Would I do it again? Yes.&lt;/h5&gt;
&lt;iframe data-city="nh" src=/visualization/airports/leaflet_airport.html?lat=41.2912&amp;lon=-72.9179&amp;zoom=13 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Boston&lt;/h2&gt;
&lt;p&gt;Logan Airport is a tricky place to walk from. It is only about two miles from downtown Boston,
but the only road there is a tunnel under the estuary with no pedestrian access.
So instead I was forced to take the long way around, through Eagle Hill,
the industrial town of Everett, and Charleston.
That route was considerably longer, but did go past
&lt;a href="https://en.wikipedia.org/wiki/Battle_of_Bunker_Hill"&gt;Bunker Hill&lt;/a&gt;
and the &lt;a href="https://en.wikipedia.org/wiki/USS_Constitution"&gt;USS Constitution&lt;/a&gt;,
and involved three bridges.&lt;/p&gt;
&lt;p&gt;Logan Airport is also at the bottom of the list of pedestrian-friendly airports.
It was &lt;em&gt;extremely&lt;/em&gt; difficult to leave without getting hit by a car.&lt;/p&gt;
&lt;h4&gt;Distance: 8 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Sure.&lt;/h4&gt;
&lt;iframe data-city="bo" src=/visualization/airports/leaflet_airport.html?lat=42.3714&amp;lon=-71.0584&amp;zoom=13 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;College Station&lt;/h2&gt;
&lt;p&gt;Boy, there is not a lot in College Station.
But there is a &lt;a href="https://en.wikipedia.org/wiki/Texas_A%26M_University"&gt;University&lt;/a&gt;
and an airport, and a straight shot of a road between them.
There weren't really any sidewalks on the road to the airport,
but there also weren't many cars, so the walk was brief and uneventful.&lt;/p&gt;
&lt;h4&gt;Distance: 3 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Yes.&lt;/h4&gt;
&lt;iframe data-city="cs" src=/visualization/airports/leaflet_airport.html?lat=30.6115&amp;lon=-96.3502&amp;zoom=14 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;San Jose&lt;/h2&gt;
&lt;p&gt;Mineta Airport is very close to downtown San Jose,
so the walk from the airport was quick and easy.
It was also boring, and has mostly left my brain.
Next time I'll take the &lt;a href="https://www.grpg.org/"&gt;river path&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Distance: 4 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Yes.&lt;/h4&gt;
&lt;iframe data-city="sj" src=/visualization/airports/leaflet_airport.html?lat=37.3835&amp;lon=-121.9342&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Philadelphia&lt;/h2&gt;
&lt;p&gt;Philadelphia International was a fun airport to walk from.
The George C. Platt bridge was cool to walk over, if not particularly pedestrian-friendly:
&lt;img alt="platt" src="articles/transit/images/platt.png" title="By Davidt8 - Own work, Public Domain, https://commons.wikimedia.org/w/index.php?curid=10874388"&gt;
There are also cheese-steaks to be had on the road,
and one can end up at the Liberty Bell.&lt;/p&gt;
&lt;h4&gt;Distance: 8 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Sure.&lt;/h4&gt;
&lt;iframe data-city="ph" src=/visualization/airports/leaflet_airport.html?lat=39.9305&amp;lon=-75.195236&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Oakland&lt;/h2&gt;
&lt;p&gt;Hey, this one is a straight-up nice walk: nice enough that I have done it twice.
The bulk of it goes across the odd estuary community of Bay Farm Island
(formerly, but not currently an island),
and Alameda island (currently, but not formerly an island).&lt;/p&gt;
&lt;p&gt;Bay Farm had previously been a known as Asparagus Island (for its principal crop),
but then it was developed for residential use, and was connected
to the mainland via the fill that became the Oakland Airport, rendering both of its names incorrect.
Now it is mostly a sleepy community with some really fun canals criss-crossing it:
&lt;img alt="bay-farm-1" src="/articles/transit/images/bay-farm-1.jpg"&gt;
&lt;img alt="bay-farm-2" src="/articles/transit/images/bay-farm-2.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Alameda, on the other hand, used to be attached to the mainland,
but was made into an island with the dredging of the Oakland estuary.
The walk along it's southern beach is quite pleasant:
&lt;img alt="alameda" src="/articles/transit/images/alameda.jpg"&gt;&lt;/p&gt;
&lt;p&gt;The only downside of the Oakland airport walk is at the end:
crossing the &lt;a href="https://en.wikipedia.org/wiki/Posey_and_Webster_Street_tube"&gt;Posey tube&lt;/a&gt;
to the mainland is no fun at all.&lt;/p&gt;
&lt;h4&gt;Distance: 10 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Definitely.&lt;/h4&gt;
&lt;iframe data-city="oak" src=/visualization/airports/leaflet_airport.html?lat=37.7637&amp;lon=-122.2634&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Los Angeles (incomplete)&lt;/h2&gt;
&lt;p&gt;I have not completed the walk from LAX: I got as far as Culver City.
The main takeaways from this unfinished effort are the Westchester is a lovely neighborhood,
and that LAX is (surprisingly enough) among the more pedestrian accessible airports.&lt;/p&gt;
&lt;h4&gt;Distance: 8 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Absolutely, I want to finish it.&lt;/h4&gt;
&lt;iframe data-city="lau" src=/visualization/airports/leaflet_airport.html?lat=34.0236&amp;lon=-118.3530&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Seattle&lt;/h2&gt;
&lt;p&gt;The walk from SeaTac Airport is among the more varied of the airport walks
that I have done. It goes through suburbia, industrial Seattle, and some
surprisingly exurban areas, before ending up downtown.
All the while, you get glimpses of Mount Rainier, and the various
Seattle waterways are never far. All in all a pretty fun walk.&lt;/p&gt;
&lt;h4&gt;Distance: 12 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Sure, given enough time.&lt;/h4&gt;
&lt;iframe data-city="sea" src=/visualization/airports/leaflet_airport.html?lat=47.5330&amp;lon=-122.2730&amp;zoom=11 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;San Francisco&lt;/h2&gt;
&lt;p&gt;This one took two tries to get right.&lt;/p&gt;
&lt;p&gt;The first time I tried to walk from SFO
I tried to go along the Bay, past Brisbane. Unfortunately, none
of the handful of roads that go that way have sidewalks, and all have
extremely fast traffic. It was hot out, and eventually I got tired of cars zooming past me
by the Brisbane Lagoon.
I hopped on Muni in Visitacion Valley.&lt;/p&gt;
&lt;p&gt;The second time I tried to walk from SFO, I decided to go the more pedestrian-friendly route:
over San Bruno Mountain. This involved no cars, but did involve climbing over
a 1000 foot peak (which is more than one typically does in these airport walks):
&lt;img alt="san-bruno" src="/articles/transit/images/san-bruno.jpg" title="View from the top towards downtown SF"&gt;&lt;/p&gt;
&lt;p&gt;On the other side of the mountain, it's pretty straightforward to pick up Mission Street
and take it the whole way downtown.&lt;/p&gt;
&lt;p&gt;Overall, the walk from SFO is challenging but rewarding.
Take San Bruno.
Also, there are good burritos to be had in South San Francisco.&lt;/p&gt;
&lt;h4&gt;Distance: 15 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Yes, given enough time.&lt;/h4&gt;
&lt;iframe data-city="sf" src=/visualization/airports/leaflet_airport.html?lat=37.7126&amp;lon=-122.4076&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;New Orleans&lt;/h2&gt;
&lt;p&gt;Okay, I screwed this one up.
I walked from Carrollton to New Orleans International,
across miles and miles of suburbia. It was mostly hot and boring,
although Lafreniere Park was enjoyable:
&lt;img alt="lafreniere" src="/articles/transit/images/lafreniere.jpg" title="Lots of ducks"&gt;&lt;/p&gt;
&lt;p&gt;And then when I arrived at the airport, I learned that I had walked to the
wrong &lt;em&gt;side&lt;/em&gt; of the airport.
And so it came to pass that I walked around the airport, on a grassy strip
between a highway and a runway. I do not recommend this.&lt;/p&gt;
&lt;p&gt;&lt;img alt="msy" src="/articles/transit/images/msy.png" title="An unpleasant walk"&gt;&lt;/p&gt;
&lt;p&gt;The worst part is this: you could do this entire walk along the levees of the
Mississippi. There is a nice pedestrian path, and people walking their dogs,
and New Orleans ne'er-do-wells. It is really nice!
&lt;img alt="bywater" src="/articles/transit/images/bywater.jpg" title="A pleasant levee walk"&gt;&lt;/p&gt;
&lt;p&gt;Anyways, the moral is: walk along more levees.&lt;/p&gt;
&lt;h4&gt;Distance: 13 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Only along the Mississippi.&lt;/h4&gt;
&lt;iframe data-city="no" src=/visualization/airports/leaflet_airport.html?lat=29.9690&amp;lon=-90.1624&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;New York (JFK)&lt;/h2&gt;
&lt;p&gt;This one also took two attempts.
In the first try, I started at the Jamaica AirTrain station and walked towards midtown
Manhattan. The roads I took were arterials, and I ran out of time, so hopped on the subway.&lt;/p&gt;
&lt;p&gt;On my next attempt, I started from JFK proper, and spent most of the time
in Brooklyn. It was mostly...uneventful.
The Jamaica sewage plant smells bad. I had avocado toast in Crown Heights.
Tourists on the Brooklyn Bridge made the last 30 minutes exceedingly slow.&lt;/p&gt;
&lt;h4&gt;Distance: 15 miles&lt;/h4&gt;
&lt;h4&gt;Would I do it again? Yes, given enough time.&lt;/h4&gt;
&lt;iframe data-city="nyu" src=/visualization/airports/leaflet_airport.html?lat=40.7194&amp;lon=-73.9000&amp;zoom=12 width=700 height=700&gt;&lt;/iframe&gt;</content></entry><entry><title>Buses are bosons, or How I learned to stop worrying and love AC Transit (Part two)</title><link href="/bus-bunching-2.html" rel="alternate"></link><published>2018-04-24T00:00:00-07:00</published><updated>2018-04-24T00:00:00-07:00</updated><author><name>Ian Rose</name></author><id>tag:None,2018-04-24:/bus-bunching-2.html</id><summary type="html">&lt;p&gt;&lt;img alt="bunch" src="/articles/transit/images/6-bunch.jpg"&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="6-bunch" src="articles/transit/images/6-bunch.jpg" title="Bunching on the 6 bus line in Oakland"&gt;&lt;/p&gt;
&lt;p&gt;This is the second and final part of a short series of articles
on constructing a mathematical model for why buses always seem to travel in packs
(known as bus bunching).&lt;/p&gt;
&lt;p&gt;In the &lt;a href="bus-bunching-1.html"&gt;previous article&lt;/a&gt;
we set up the model, consisting of &lt;span class="math"&gt;\(N\)&lt;/span&gt; buses traveling on a loop,
where we parameterized the position of the &lt;span class="math"&gt;\(n\)&lt;/span&gt;th bus by &lt;span class="math"&gt;\(\theta_n\)&lt;/span&gt;.
We presumed that a bus is slowed down by the boarding of passengers,
and that more passengers will need to board if it has been longer
since the last bus came along, an effect given by a parameter &lt;span class="math"&gt;\(\gamma\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The equations for this model are given by
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d\theta_n}{d t} = 
 v_0 \left[ 1 - \gamma (\theta_{n+1} - \theta_n) \right]
\label{evolution}
\end{equation}&lt;/div&gt;
&lt;p&gt;We furthermore showed that the equilibrium configuration for a set of &lt;span class="math"&gt;\(N\)&lt;/span&gt; buses
is for them to be equally spaced along the route, traveling at a velocity of &lt;span class="math"&gt;\(v_e\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
v_e = v_0 \left[ 1 - \frac{2 \pi \gamma}{N} \right]
\label{equilibrium}
\end{equation}&lt;/div&gt;
&lt;p&gt;In system with five buses, and in reference frame traveling at a velocity of &lt;span class="math"&gt;\(v_e\)&lt;/span&gt;,
this equilibrium solution looks like this:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=false&amp;equilibrium=true&amp;boost=true&amp;gamma=0.15&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;

&lt;p&gt;In this article we will demonstrating that this equilibrium solution is not stable,
and that it will inevitably result in the buses bunching.&lt;/p&gt;
&lt;h2&gt;Stability analysis&lt;/h2&gt;
&lt;p&gt;Most stability analyses are centered on answering a central question:
is my equilibrium solution stable with respect to small perturbations?
That is to say, if I have an equilibrium solution and poke it slightly,
does it return to equilibrium, or does that poke keep growing until the solution
is no longer anything like the equilibrium one?
&lt;img alt="stability" src="articles/transit/images/stability.png" title="Illustration of stability"&gt;
This behavior can be visualized by thinking of a ball balanced on a hill,
and another resting in a trough.
Both of the balls are not moving around, and are thus in equilibrium solutions.
However, if I nudge the ball on the hill, it will continue rolling until it is far from the peak.
If I nudge the ball in the trough, it will roll back to the middle and
eventually come to a rest.
The first situation is an unstable equilibrium, and the second is a stable one.&lt;/p&gt;
&lt;p&gt;Our approach for analyzing the system of equations in equation \eqref{evolution} will be similar:
we will investigate its behavior when we nudge it slightly away from the equilibrium solution
represented by equation \eqref{equilibrium}.
If those nudges grow in time, it is unstable.
If they die off in time, it is stable.&lt;/p&gt;
&lt;h2&gt;Perturbation equations&lt;/h2&gt;
&lt;p&gt;The first step in deriving the perturbation equations is to split the
bus positions &lt;span class="math"&gt;\(\theta_n(t)\)&lt;/span&gt; into two parts, an equilibrium part and a perturbation:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\theta_n = \theta^e_n + \theta^\prime_n
\label{decompose}
\end{equation}&lt;/div&gt;
&lt;p&gt;In equation \eqref{decompose}, &lt;span class="math"&gt;\(\theta^e_n\)&lt;/span&gt; is the equilibrium solution for the buses
(i.e. &lt;span class="math"&gt;\(v_e\)&lt;/span&gt; integrated with respect to time),
and &lt;span class="math"&gt;\(\theta^\prime_n\)&lt;/span&gt; is a small perturbation away from that equilibrium.
You may wonder what the perturbation actually &lt;em&gt;is&lt;/em&gt;, since it can be a function of time,
and each of the buses can have a different perturbation.
Fortunately, we will be able to show that this analysis does not depend on the form
of the perturbation (other than that it is nonzero), so it can be completely arbitrary.&lt;/p&gt;
&lt;p&gt;The governing equations are in terms of velocities rather than positions,
so we take the time derivative of equation \eqref{decompose},
noting that &lt;span class="math"&gt;\(d \theta^e_n / dt = v^e\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta_n}{dt} = \frac{d \theta^e_n}{dt} + \frac{d \theta^\prime_n}{dt} = v_e + \frac{d \theta^\prime_n}{dt}
\label{decompose2}
\end{equation}&lt;/div&gt;
&lt;p&gt;We can substitute equations \eqref{decompose} and \eqref{decompose2}
into equation \eqref{evolution} to get
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta^\prime_n}{dt} + v_e = 
v_0 \left[ 1 - \gamma (\theta^e_{n+1} - \theta^e_n) - \gamma(\theta^\prime_{n+1} - \theta^\prime_n) \right]
\end{equation}&lt;/div&gt;
&lt;p&gt;
Note that in the equilibrium configuration the buses are equally spaced,
so &lt;span class="math"&gt;\(\theta^e_{n+1} - \theta^e_{n} = 2 \pi / N\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta^\prime_n}{dt} + v_e = 
v_0 \left[ 1 - \frac{2 \pi \gamma}{N}  - \gamma(\theta^\prime_{n+1} - \theta^\prime_n) \right]
\end{equation}&lt;/div&gt;
&lt;p&gt;This allows &lt;span class="math"&gt;\(v_e\)&lt;/span&gt; to be subtracted from both sides, leaving us with:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta^\prime_n}{dt} = 
v_0 \gamma(\theta^\prime_{n} - \theta^\prime_{n+1})
\label{perturb}
\end{equation}&lt;/div&gt;
&lt;p&gt;Okay, so what did those manipulations buy us?
There are two attractive features that equation \eqref{perturb} has:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;It is now a system of differential equations involving only the perturbations,
the time evolution of which we are interested in for the stability problem.
The equilibrium solution has completely disappeared.&lt;/li&gt;
&lt;li&gt;More importantly, &lt;em&gt;it is now a system of linear equations!&lt;/em&gt;
There are no nonlinearities or constant offsets getting in our way.
And if there is one thing mathematics is good at analyzing, it is linear equations.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In fact, since it is a set of linear equations,
we can write it using matrix notation:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \Theta^\prime}{d t} = 
\mathbf{A}\Theta^\prime
\label{matrix}
\end{equation}&lt;/div&gt;
&lt;p&gt;
where &lt;span class="math"&gt;\(\Theta^\prime\)&lt;/span&gt; is a vector containing all the perturbations to the &lt;span class="math"&gt;\(N\)&lt;/span&gt; buses,
and &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt; is a matrix describing the linear coupling between the buses, given by:&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\mathbf{A} = 
v_0 \gamma 
\begin{bmatrix}
1 &amp;amp; -1 &amp;amp; 0 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 0 \\
0 &amp;amp; 1 &amp;amp; -1 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 0 \\
0 &amp;amp; 0 &amp;amp; 1 &amp;amp; -1 &amp;amp; \ldots &amp;amp; 0 \\
\vdots &amp;amp; \vdots &amp;amp; \vdots &amp;amp; \vdots &amp;amp; \ddots &amp;amp; \vdots \\
-1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 1\\
\end{bmatrix}
\label{A}
\end{equation}&lt;/div&gt;
&lt;p&gt;
Note that the last row couples the speed of the &lt;span class="math"&gt;\(N\)&lt;/span&gt;th bus to the first bus,
reflecting the circular nature of the model.&lt;/p&gt;
&lt;h2&gt;The eigendecomposition&lt;/h2&gt;
&lt;p&gt;When analyzing a system of linear equations,
it is often helpful consider it in terms of its eigenvalues and eigenvectors
(exactly how it is helpful should be clearer in a moment).
A general perturbation vector &lt;span class="math"&gt;\(\Theta^\prime\)&lt;/span&gt; can be decomposed
into a linear combination of the &lt;span class="math"&gt;\(N\)&lt;/span&gt; eigenvectors of &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt;
(known as an &lt;a href="https://en.wikipedia.org/wiki/Eigenvalues_and_eigenvectors#Eigenspaces,_geometric_multiplicity,_and_the_eigenbasis_for_matrices"&gt;eigendecomposition&lt;/a&gt;):
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\Theta^\prime(t) = \sum_k a_k(t) \Theta^\prime_k
\label{eigs}
\end{equation}&lt;/div&gt;
&lt;p&gt;
where &lt;span class="math"&gt;\(a_k(t)\)&lt;/span&gt; is the amount of that each eigenvector &lt;span class="math"&gt;\(\Theta^\prime_k\)&lt;/span&gt;
contributes to the total perturbation &lt;span class="math"&gt;\(\Theta^\prime_k(t)\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Substituting equation \eqref{eigs} into \eqref{matrix}, we get
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\sum_k \frac{d a_k}{dt} \Theta^\prime_k = 
\sum_k a_k \mathbf{A}\Theta^\prime_k = 
\sum_k a_k \lambda_k \Theta^\prime_k
\end{equation}&lt;/div&gt;
&lt;p&gt;
where we have used the definition of the eigenvalues &lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt;:
&lt;span class="math"&gt;\(\mathbf{A}\Theta^\prime_k = \lambda_k \Theta^\prime_k\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The eigenvectors of &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt; are linearly independent,
so the components of the summation decouple,
giving us a set of independent ordinary differential equations:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d a_k}{d t} = 
\lambda_k a_k
\label{diff_eigen}
\end{equation}&lt;/div&gt;
&lt;p&gt;Equation \eqref{diff_eigen} looks very much like equation \eqref{matrix},
but with one important difference:
It is now a scalar equation for the time evolution of &lt;span class="math"&gt;\(a_k\)&lt;/span&gt;.
In fact, it the solution of this ordinary differential equation is among the
first that students of calculus learn to find: an exponential:&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
a_k(t) = a_k(0) e^{\lambda_k t}
\label{integrated}
\end{equation}&lt;/div&gt;
&lt;h2&gt;A hunt for eigenvalues&lt;/h2&gt;
&lt;p&gt;Equation \eqref{integrated} gives us the solution for the
time evolution of the perturbations of &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt;.
Remember, our perturbation to the equilibrium solution can be written
as a combination of the eigenvectors, and we are interested in whether
the perturbation grows in time or shrinks in time.
The answer to that question all comes down to the values for the eigenvalues &lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt;.
Broadly speaking, there are three possibilities:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; is negative. In this case, a perturbation of the shape of &lt;span class="math"&gt;\(\Theta^\prime_k\)&lt;/span&gt;
will shrink in time, since \eqref{integrated} is a negative exponential.&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; is positive. In this case, a perturbation of the shape of &lt;span class="math"&gt;\(\Theta^\prime_k\)&lt;/span&gt;
will grow in time, since \eqref{integrated} is a positive exponential.&lt;/li&gt;
&lt;li&gt;&lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; is complex. In this case, a perturbation of the shape of &lt;span class="math"&gt;\(\Theta^\prime_k\)&lt;/span&gt;
will have combined behaviors: it will oscillate according to the imaginary part
of &lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; (due to &lt;a href="https://en.wikipedia.org/wiki/Euler%27s_formula"&gt;Euler's formula&lt;/a&gt;),
and either shrink or grow according to the sign of the real part.
For our purposes, we want to know it shrinks or grows,
so we are most interested in the real part of any complex eigenvalues.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In physical systems, there is always a certain amount of noise,
and in general that noise will put some amount of power
into each of the eigenvectors of the system.
Some eigenvectors might get a bit more power, some might get a bit less,
but for random, uncorrelated noise, we expect all the eigenvectors to get some.
This means that if &lt;em&gt;just one&lt;/em&gt; eigenvalue has a positive real part,
then the power in that eigenvalue will blow up.
Therefore our stability metric is this: &lt;em&gt;all&lt;/em&gt; of the eigenvalues must have
negative real parts for the system to be considered stable to perturbations.&lt;/p&gt;
&lt;p&gt;So let's find the eigenvalues of &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt;.
Usually calculating the eigenvalues of a matrix of a larger order than 2 or 3
is a pretty involved process, but in this case the matrix is
ordered enough, and has enough zeroes in it, that we can come up
with a closed-form solution.&lt;/p&gt;
&lt;p&gt;The eigenvalues of &lt;span class="math"&gt;\(\mathbf{A}\)&lt;/span&gt; can be found by solving its
&lt;a href="https://en.wikipedia.org/wiki/Characteristic_polynomial"&gt;characteristic polynomial&lt;/a&gt;,
found by taking the determinant of &lt;span class="math"&gt;\(\mathbf{A} - \lambda \mathbf{I}\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
det(\mathbf{A - \lambda \mathbf{I}}) = 
(v_0 \gamma)^N 
\begin{vmatrix}
1-\lambda &amp;amp; -1 &amp;amp; 0 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 0 \\
0 &amp;amp; 1-\lambda &amp;amp; -1 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 0 \\
0 &amp;amp; 0 &amp;amp; 1-\lambda &amp;amp; -1 &amp;amp; \ldots &amp;amp; 0 \\
\vdots &amp;amp; \vdots &amp;amp; \vdots &amp;amp; \vdots &amp;amp; \ddots &amp;amp; \vdots \\
-1 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0 &amp;amp; \ldots &amp;amp; 1-\lambda\\
\end{vmatrix}
\end{equation}&lt;/div&gt;
&lt;p&gt;We apply the &lt;a href="https://en.wikipedia.org/wiki/Laplace_expansion"&gt;Laplace expansion&lt;/a&gt;
(where I have elided some steps):
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
det(\mathbf{A} - \lambda \mathbf{I}) = 
(v_0 \gamma)^N \left[ (1-\lambda)^N + (-1)(-1)^{N+1}(-1)^{N-1} \right] = 0
\end{equation}&lt;/div&gt;
&lt;p&gt;which may be simplified to&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
(1-\lambda)^N = 1
\end{equation}&lt;/div&gt;
&lt;p&gt;Now, this polynomial equation of order &lt;span class="math"&gt;\(N\)&lt;/span&gt; has a fairly straightforward set
of solutions for &lt;span class="math"&gt;\(\lambda\)&lt;/span&gt;: they are the
&lt;a href="https://en.wikipedia.org/wiki/Root_of_unity"&gt;roots of unity&lt;/a&gt;,
shifted along the positive &lt;span class="math"&gt;\(x\)&lt;/span&gt;-axis by one.&lt;/p&gt;
&lt;p&gt;We can write the solution for &lt;span class="math"&gt;\(\lambda_k\)&lt;/span&gt; explicitly
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\lambda_k = e^{\frac{2 k \pi i}{N}} + 1 = \cos \frac{2 k \pi}{N} + i \sin \frac{2 k \pi}{N} + 1
\end{equation}&lt;/div&gt;
&lt;p&gt;
which, when plotted (for &lt;span class="math"&gt;\(N=10\)&lt;/span&gt;), gives the following:&lt;/p&gt;
&lt;p&gt;&lt;img alt="roots_of_unity" src="articles/transit/images/roots_of_unity.png" title="Eigenvalues of the stability problem"&gt;&lt;/p&gt;
&lt;p&gt;Hey, look at that! The real part of each eigenvalue is greater than zero!&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;
That is to say, not only is the system unstable, it is &lt;em&gt;wildly&lt;/em&gt; unstable.
Remember, the system is unstable if if &lt;em&gt;just one&lt;/em&gt; of the eigenvalues has a positive real part.&lt;/p&gt;
&lt;h2&gt;Simulating bus bunching&lt;/h2&gt;
&lt;p&gt;That was a long way to go,
but by determining that the eigenvalues of the system of equations \eqref{perturb}
all have nonnegative real parts, we determined that any perturbation
to our equilibrium solution is unstable.
Therefore, if any of the buses on our bus route get slightly off schedule,
they will continue to get further and further off schedule.&lt;/p&gt;
&lt;p&gt;Let's close out the article with some interactive simulations of bus bunching.
The simulations start with a number of buses in the equilibrium configuration,
but as you will see, they soon drift away from that equilibrium, and once they
start to drift, bunching is inevitable.&lt;/p&gt;
&lt;p&gt;There are two versions of the simulation: one in the &lt;span class="math"&gt;\(v_e\)&lt;/span&gt; reference frame,
where we see the velocities of the buses relative to their equilibrium velocity,
and one in the street frame, where we see the velocities of the buses relative to the road.&lt;/p&gt;
&lt;p&gt;In the &lt;span class="math"&gt;\(v_e\)&lt;/span&gt; reference frame:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=true&amp;equilibrium=false&amp;boost=true&amp;gamma=0.15&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;

&lt;p&gt;In the street reference frame:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=true&amp;equilibrium=false&amp;boost=false&amp;gamma=0.15&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The model we analyzed here was probably about as simple as it could be
while still exhibiting bunching behavior. We used a simplified geometry,
and it really only had two parameters (&lt;span class="math"&gt;\(v_0\)&lt;/span&gt;, the speed in the absence of passengers,
and &lt;span class="math"&gt;\(\gamma\)&lt;/span&gt;, the amount by which passenger boarding slows it down).
Nevertheless, it demonstrates a plausible mechanism for an all-too familiar
occurrence for transit riders.&lt;/p&gt;
&lt;p&gt;The good news is that actual bus system behavior can be more complex than this
simple model: it has drivers, schedulers, and real-time information.
It is possible to design things to mitigate the essential bunchiness of a route.
Things like &lt;a href="https://thesource.metro.net/2017/10/14/all-door-boarding-proposed-for-720-and-754-rapid-lines/"&gt;streamlined passenger boarding&lt;/a&gt;,
&lt;a href="https://en.wikipedia.org/wiki/Bus_priority"&gt;signal priority&lt;/a&gt;,
and layovers all likely have a role in mitigating bunching.&lt;/p&gt;
&lt;p&gt;So what's the moral here? I'd like to say that you shouldn't feel frustrated
the next time a pack of buses roll up to your stop, but that's probably not realistic.
Instead, maybe just look at them with grim recognition.&lt;/p&gt;
&lt;p&gt;&lt;img alt="18-bunch" src="articles/transit/images/18-bunch.jpg" title="Bunching on the 18 bus line in Albany"&gt;&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Strictly speaking, there is a single eigenvalue that is equal to zero, 
when &lt;span class="math"&gt;\(k=N\)&lt;/span&gt;. You can verify manually that this corresponds to an eigenvector
where each bus is perturbed by the same amount (a &lt;span class="math"&gt;\(\mathbf{1}\)&lt;/span&gt; vector).
A perturbation of this form is marginally stable (neither stable nor unstable),
since none of the buses get any closer to or further from each other.
For the pedantic, you can replace of my statements about all eigenvegors 
being unstable with "all eigenvectors but one are unstable".&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content></entry><entry><title>Buses are bosons, or How I learned to stop worrying and love AC Transit (Part one)</title><link href="/bus-bunching-1.html" rel="alternate"></link><published>2018-03-19T00:00:00-07:00</published><updated>2018-03-19T00:00:00-07:00</updated><author><name>Ian Rose</name></author><id>tag:None,2018-03-19:/bus-bunching-1.html</id><summary type="html">&lt;p&gt;&lt;img alt="bunch" src="/articles/transit/images/18-bunch.jpg"&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;If you have spent any amount of time using mass transit,
you know the frustration of waiting for the better part of an hour for a bus to arrive,
only to see two or three of them roll up in quick succession.
This phenomenon is a common enough problem that it has a name: "bus bunching":&lt;/p&gt;
&lt;p&gt;&lt;img alt="18-bunch2" src="articles/transit/images/18-bunch2.jpg" title="Bunching on the 18 bus line in Berkeley"&gt;&lt;/p&gt;
&lt;p&gt;In this two-part series, we'll investigate bus bunching by making a mathematical model of a bus route.
In this first part, we'll construct the model and find it's equilibrium solution.
In the second part, we'll demonstrate the inevitability for that model to bunch.&lt;/p&gt;
&lt;p&gt;Let's start by constructing a model for the speed of a single bus.
We will assume that the bus has a fixed route, on which it travels all day.
That route may be on any number of different streets, go wending through different
neighborhoods, and generally make very little sense 
(like my beloved &lt;a href="http://www.actransit.org/pdf/maps/version_38/12.pdf"&gt;12 line&lt;/a&gt;).
However, if it travels back and forth on this same route, we can model it as a loop,
and its position on that loop can be mapped to an angle on a circle &lt;span class="math"&gt;\(\theta\)&lt;/span&gt;.
We can then identify the speed of the bus with the time derivative of &lt;span class="math"&gt;\(\theta\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;The simplest model for &lt;span class="math"&gt;\(d\theta/ dt\)&lt;/span&gt; is for the bus to travel at a constant speed &lt;span class="math"&gt;\(v_0\)&lt;/span&gt;:&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta}{d t} = v_0
\end{equation}&lt;/div&gt;
&lt;p&gt;
Or, expressed in a simulation:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=false&amp;boost=false&amp;equilibrium=true&amp;gamma=0&amp;n=1 width=700 height=700&gt;&lt;/iframe&gt;

&lt;p&gt;Now, this model isn't very interesting.
There is only a single bus, and it is traveling at a fixed speed,
so it has no hope of exhibiting the kind of bunching behavior that we want to explain.&lt;/p&gt;
&lt;p&gt;A typical mass transit route operates multiple buses with a given
&lt;a href="https://en.wikipedia.org/wiki/Headway"&gt;headway&lt;/a&gt;,
the distance (or time) between successive vehicles on the route.
If everything is operating according to the plan,
the headway from one bus to the next should be approximately constant,
with possible scheduled variations depending on the time of day
(such as increased frequency during rush hour, or decreased frequency at night).&lt;/p&gt;
&lt;p&gt;We can increase the complexity of our model adding some more buses so that there are &lt;span class="math"&gt;\(N\)&lt;/span&gt; on the route:&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \theta_n}{d t} = v_0
\label{constant}
\end{equation}&lt;/div&gt;
&lt;p&gt;In this equation the subscript indicates the &lt;span class="math"&gt;\(n\)&lt;/span&gt;th bus out of &lt;span class="math"&gt;\(N\)&lt;/span&gt;,
so a simulation with five buses looks like this:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=false&amp;equilibrium=true&amp;boost=false&amp;gamma=0&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;
&lt;p&gt;Okay, so this is starting to more closely resemble a bus route.
However, the buses are still moving at a constant speed, and have no effect on each other.
In order for our model to exhibit the richer characteristics of a system that can bunch,
there must be some way for their speed to be a function of conditions on the road.&lt;/p&gt;
&lt;p&gt;There are many factors that can control the speed of a bus traveling through town,
including traffic, construction, scheduled layovers, and the number of passengers.
In order to keep the model simple, we will focus on the last factor:
the number of passengers who board and exit the bus.
A traveling bus constantly picks up and drops off passengers as it makes its way around its route.
This process takes time (as anyone who has watched a passenger fumble with change upon boarding knows).
A bus that boards and deposits more passengers will, in general, make slower progress along its route.&lt;/p&gt;
&lt;p&gt;Many things affect the number of passengers boarding a given bus, 
including time-of-day, scheduling, and population density.
In order to keep the model as simple as possible, we will ignore those and
concentrate on a single factor: the amount of time since the previous bus.
We will assume that as more time passes, more passengers arrive at a bus stop for pickup.
If a bus falls behind schedule, more people will have arrived at each stop,
meaning that it will be further slowed down by the excess passengers.
In the following analysis, we will use the distance between buses as a proxy
for the number of passengers that need to be picked up.&lt;/p&gt;
&lt;p&gt;We need to augment our model to account for this slowing-down behavior.
The expression for speed in equation \eqref{constant} is a constant,
so the next-simplest expression is to make it linear in the distance between buses
(our proxy for the number of passengers):
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d\theta_n}{d t} = 
 v_0 \left[ 1 - \gamma (\theta_{n+1} - \theta_n) \right]
\label{evolution}
\end{equation}&lt;/div&gt;
&lt;p&gt;In this equation, a bus picking up &lt;em&gt;no&lt;/em&gt; passengers travels at &lt;span class="math"&gt;\(v_0\)&lt;/span&gt;
(which happens if there has been no time for them to accumulate since the previous bus).
As the distance between a bus and the one ahead of it increases,
the speed of the bus slows down, reflecting the additional time spent boarding and disembarking.
The dimensionless parameter &lt;span class="math"&gt;\(\gamma\)&lt;/span&gt; determines how sensitive the bus speeds are to differences in headway.&lt;/p&gt;
&lt;p&gt;Equation \eqref{evolution} is a set of ordinary differential equations
(one equation for each of the &lt;span class="math"&gt;\(N\)&lt;/span&gt; buses).
It will be the primary  evolution equation for our system of buses,
which we will analyze by answering the following two questions.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Is there an equilibrium solution to these equations?
That is to say, is there a solution that does not evolve in time?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If there is an equilibrium solution, is it stable?
A stable solution, when perturbed, will return to the equilibrium.
An unstable one will get further and further from equilibrium until the buses are bunched.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Strictly speaking, an equilibrium solution does not exist for the system of equations as described:
as long as the buses have a nonzero velocity, their positions will evolve in time.
However, with a slight reframing of the question it makes sense to talk about an equilibrium:
is there a configuration for which the bus velocities are constant,
and that the distance between them (headways) are not changing?&lt;/p&gt;
&lt;p&gt;In a coordinate system traveling with the buses at equilibrium speed
the solution to the system would then look like this:&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=false&amp;equilibrium=true&amp;boost=true&amp;gamma=0&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;

&lt;p&gt;It seems intuitive that an equilibrium solution, if it exists,
should have the buses equally spaced, so let's start looking for a solution of that form.
Let's further guess that the equilibrium velocity is the base bus speed &lt;span class="math"&gt;\(v_0\)&lt;/span&gt;.
A change of coordinates makes this system a bit easier to reason about.
Let's boost ourselves into moving a coordinate system &lt;span class="math"&gt;\(\psi\)&lt;/span&gt;, defined by:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\psi_n \equiv \theta_n - v_0 t
\end{equation}&lt;/div&gt;
&lt;p&gt;From this we can also get the relations
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d\theta_n}{d t} =
\frac{d \psi_n}{d t} + v_0
\end{equation}&lt;/div&gt;
&lt;div class="math"&gt;\begin{equation}
\theta_n =
\psi_n + v_0 t
\end{equation}&lt;/div&gt;
&lt;p&gt;Substituting these into equation \eqref{evolution},
we get the governing equations in terms of &lt;span class="math"&gt;\(\psi_n\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \psi_n}{d t} + v_0 = 
v_0 \left[ 1 - \gamma (\psi_{n+1} - \psi_n) \right]
\end{equation}&lt;/div&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \psi_n}{d t} = 
v_0 \gamma (\psi_{n} - \psi_{n+1})
\end{equation}&lt;/div&gt;
&lt;p&gt;When the buses are equally spaced around the loop, then the distance
between them is the whole loop length divided between the number of buses, or
&lt;span class="math"&gt;\(\psi_{n+1} - \psi_n = 2 \pi/N\)&lt;/span&gt;,
which makes the governing equations in the &lt;span class="math"&gt;\(\psi\)&lt;/span&gt; coordinates&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \psi_n}{d t} = 
\frac{ 2 \pi v_0 \gamma }{N}
\end{equation}&lt;/div&gt;
&lt;p&gt;Unless the interaction term &lt;span class="math"&gt;\(\gamma\)&lt;/span&gt; is zero, the time evolution of &lt;span class="math"&gt;\(\psi_n\)&lt;/span&gt; is nonzero,
making this configuration a non-equilibrium solution to the system.
Therefore, &lt;span class="math"&gt;\(v_0\)&lt;/span&gt; is &lt;em&gt;not&lt;/em&gt; the equilibrium velocity.&lt;/p&gt;
&lt;p&gt;This should make sense, as we defined &lt;span class="math"&gt;\(v_0\)&lt;/span&gt; to be the speed of the bus
in the absence of any delays due to loading and unloading of passengers.
When we include that delay, the buses will be slower.
Instead, let's construct a speed for buses that takes into account the
delay due to passengers.&lt;/p&gt;
&lt;p&gt;Again we presume that the buses are equally spaced,
such that the distance between them is &lt;span class="math"&gt;\(2 \pi/N\)&lt;/span&gt;.
Then, given the evolution equation \eqref{evolution}, we can calculate the speed &lt;span class="math"&gt;\(v_e\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
v_e = \frac{d \theta_n}{d_t} = v_0 \left[ 1 - \frac{2 \pi \gamma}{N} \right]
\end{equation}&lt;/div&gt;
&lt;p&gt;
Let's boost into a &lt;em&gt;new&lt;/em&gt; coordinate system &lt;span class="math"&gt;\(\phi\)&lt;/span&gt;, defined by
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\phi_n \equiv \theta_n - v_e t
\end{equation}&lt;/div&gt;
&lt;p&gt;Substituting this into equation \eqref{evolution}, we find&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \phi_n}{d t} + v_e =
v_0 \left[ 1 - \gamma \left(\phi_{n+1} - \phi_n \right) \right]
\end{equation}&lt;/div&gt;
&lt;p&gt;
As before, when the buses are equally spaced, &lt;span class="math"&gt;\(\phi_{n+1} - \phi_n = 2 \pi/N\)&lt;/span&gt;:
&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \phi_n}{d t} + v_e =
v_0 \left[ 1 - \frac{2 \pi \gamma}{N}  \right]
\end{equation}&lt;/div&gt;
&lt;p&gt;The right-hand-side is exactly &lt;span class="math"&gt;\(v_e\)&lt;/span&gt;, so we can subtract it from both sides to get&lt;/p&gt;
&lt;div class="math"&gt;\begin{equation}
\frac{d \phi_n}{d t} = 0
\end{equation}&lt;/div&gt;
&lt;p&gt;
This is exactly what we wanted: in the &lt;span class="math"&gt;\(\phi\)&lt;/span&gt; coordinate system,
the positions of the buses are constant in time, so
equally-spaced buses are all in equilibrium.&lt;/p&gt;
&lt;p&gt;In order to get a feel for the equilibrium solution,
you can experiment with this interactive simulation, which shows the buses
traveling at their equilibrium speed and spacing
(in the &lt;span class="math"&gt;\(\phi\)&lt;/span&gt; coordinate system that moves with them).&lt;/p&gt;
&lt;iframe src=/visualization/bus/bus-bunching.html?interactive=true&amp;equilibrium=true&amp;boost=true&amp;gamma=0.15&amp;n=5 width=700 height=700&gt;&lt;/iframe&gt;

&lt;p&gt;You can see that as the number of buses increases and the headway between the buses gets smaller,
the equilibrium speed increases, reflecting the decreased number of passengers each has to pick up.&lt;/p&gt;
&lt;p&gt;At this point we have answered the first of the two above questions: there is an equilibrium solution.
In the next installment of this series, we are going to answer the second question:
is this equilibrium solution stable? (Spoiler: it's not.)&lt;/p&gt;
&lt;p&gt;&lt;img alt="streetcar" src="/articles/transit/images/streetcar-bunch.jpg" title="New Orleans streetcars can be bunched too"&gt;&lt;/p&gt;
&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content></entry><entry><title>Mapping California Cities</title><link href="/mapping-california-cities.html" rel="alternate"></link><published>2018-02-08T00:00:00-08:00</published><updated>2018-02-08T00:00:00-08:00</updated><author><name>Ian Rose</name></author><id>tag:None,2018-02-08:/mapping-california-cities.html</id><summary type="html">&lt;p&gt;&lt;img alt="la_cities" src="/articles/transit/images/la_cities_small.png"&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;TL;DR: We are making these maps:&lt;/p&gt;
&lt;p&gt;&lt;img alt="los-angeles" src="/articles/transit/images/la_cities_small.png"&gt;
&lt;img alt="bay-area" src="/articles/transit/images/bay_area_cities_small.png"&gt;&lt;/p&gt;
&lt;p&gt;A couple of weeks ago a colleague told me that she was moving out of Oakland, California,
to a city on the San Francisco peninsula called San Carlos.
I had been a resident of the Bay Area for most of my life,
and consider myself reasonably geographically aware, and I had never heard of San Carlos.&lt;/p&gt;
&lt;p&gt;That sent me down a rabbit hole of trying to find a political map of the Bay Area
that showed all of the incorporated municipalities. The Wikipedia article on the
&lt;a href="https://en.wikipedia.org/wiki/San_Francisco_Bay_Area#Government_and_politics"&gt;Bay Area&lt;/a&gt;
claims that there are 101 cities and towns within the nine counties that make up
the larger metropolitan area. Surprisingly, I was
&lt;a href="https://www.google.com/search?q=map+of+bay+area+cities&amp;amp;client=ubuntu&amp;amp;hs=BWu&amp;amp;channel=fs&amp;amp;source=lnms&amp;amp;tbm=isch&amp;amp;sa=X&amp;amp;ved=0ahUKEwjo-ImVhZfZAhVJ0WMKHbw1DoUQ_AUICigB&amp;amp;biw=1472&amp;amp;bih=722"&gt;unable&lt;/a&gt;
to come up with a map that actually showed those cities and their boundaries,
or really anything close to that.&lt;/p&gt;
&lt;p&gt;Meanwhile, I moved to Los Angeles. This is a new metropolitan area to me,
and I am much less familiar with the patchwork of cities that comprise it.
Again, I tried to find a map that showed these cities. I had a bit more success
(&lt;a href="http://www.laalmanac.com/geography/ge30ba.php"&gt;this&lt;/a&gt; map gets pretty close),
but still was missing some of the information that I wanted.&lt;/p&gt;
&lt;p&gt;So, like any self-respecting geologist, I set out to make the maps I wanted.
These maps would do the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Show the incorporated municipalities in the metropolitan area.
No counties, no parks, no neighborhoods, no unincorporated areas,
no &lt;a href="https://en.wikipedia.org/wiki/Census-designated_place"&gt;census-designated places&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Show some of the physiography of the area. The placement and shape of human settlements
are controlled by oceans, rivers, hills, and mountains.
I find it annoying and confusing to look at maps that omit these,
as the pattern of settlement winds up looking much more random than it actually is.&lt;/li&gt;
&lt;li&gt;Be somewhat nice to look at.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So, let's get started. I'll use the LA area as an example here, I used
essentially the same code to generate the high-resolution map of the Bay Area.&lt;/p&gt;
&lt;h1&gt;Acquiring the data&lt;/h1&gt;
&lt;p&gt;To begin, we need to download the data, both political and physical.&lt;/p&gt;
&lt;h2&gt;Political data&lt;/h2&gt;
&lt;p&gt;The biggest source of open mapping data comes from the
&lt;a href="https://www.openstreetmap.org"&gt;OpenStreetMap&lt;/a&gt; community.
They have a truly staggering amount of data that is reasonably up-to-date.&lt;/p&gt;
&lt;p&gt;The downside of this is that the data is so vast that it becomes difficult
to download and parse. &lt;a href="http://extract.bbbike.org/"&gt;This&lt;/a&gt; website was useful
to me in constructing the request for downloading a subset of the OSM data
(in this case, a box around the LA metropolitan area).&lt;/p&gt;
&lt;p&gt;The data is downloaded in an large binary database, which you then need to
query for the data you want. There are a number of OSM readers available:
I chose to use the &lt;a href="http://www.gdal.org/"&gt;Geospatial Data Abstraction Library (GDAL)&lt;/a&gt;,
which has the ability to read and transform vector and raster GIS data
in just about any format.&lt;/p&gt;
&lt;p&gt;The extract of all Southern California vector data is about 1 GB in size,
but we can extract the subset we are interested using a SQL-ish command
line argument for the GDAL program &lt;code&gt;ogr2ogr&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ogr2ogr -sql &lt;span class="s2"&gt;&amp;quot;SELECT * FROM multipolygons WHERE admin_level=&amp;#39;8&amp;#39;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
        -f &lt;span class="s2"&gt;&amp;quot;ESRI Shapefile&amp;quot;&lt;/span&gt; data/la_cities data/los_angeles.osm.pbf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This command selects from the database all of the multipolygons
(your basic GIS data structure for shapes, including city borders)
where the &lt;code&gt;admin_level&lt;/code&gt; property is set to &lt;code&gt;'8'&lt;/code&gt;, indicating a municipality.
The output format is set to &lt;a href="https://www.esri.com/library/whitepapers/pdfs/shapefile.pdf"&gt;ESRI Shapefile&lt;/a&gt;,
and the data is placed in the &lt;code&gt;la_cities&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;We will also have need for the populations of the cities, which is
located in the same database, but in a different table.
The following command extracts those populations, and stores them
in a GeoJSON file &lt;code&gt;la_cities.geojson&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ogr2ogr -sql &lt;span class="s2"&gt;&amp;quot;SELECT * FROM points WHERE population IS NOT NULL and name IS NOT NULL&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
        -f &lt;span class="s2"&gt;&amp;quot;GeoJSON&amp;quot;&lt;/span&gt; data/la_cities.geojson data/los_angeles.osm.pbf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Physical data&lt;/h2&gt;
&lt;p&gt;We will use elevation data from NASA to construct the physiographic part of the map.
The &lt;a href="https://www2.jpl.nasa.gov/srtm/"&gt;Shuttle Radar Topography Mission&lt;/a&gt; generated
worldwide topography data at 10 meter resolution, which is good enough to make
a very attractive map. Unfortunately, the data is a bit tricky to download, and
the NASA website itself has a lot of dead links. &lt;a href="http://dwtkns.com/srtm30m/"&gt;This&lt;/a&gt;
website provided a much better interface for downloading the same underlying data.&lt;/p&gt;
&lt;p&gt;The data is, by default, downloadable in 1 degree by 1 degree chunks.
We can stich them together into one GeoTiff using the GDAL command-line tool &lt;code&gt;gdal_merge.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gdal_merge.py -o data/socal.tif -of png data/N3?W1??.hgt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once the physical and political data are downloaded and preprocessed,
we are ready to start making the map!&lt;/p&gt;
&lt;h1&gt;Plotting the terrain&lt;/h1&gt;
&lt;p&gt;We can load the raw elevation data into our Python session using GDAL,
and then plot it using the mapping library &lt;a href="http://scitools.org.uk/cartopy/"&gt;cartopy&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;gdal&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;plt&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cartopy.crs&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;ccrs&lt;/span&gt;

&lt;span class="c1"&gt;# Load the data&lt;/span&gt;
&lt;span class="n"&gt;socal&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gdal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data/socal.tif&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;z_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;socal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ReadAsArray&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the data&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;
&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;120.0001389&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;32.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;35.0001389&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;z_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gist_gray&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_elev.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="socal_elev" src="/articles/transit/images/socal_elev.png"&gt;&lt;/p&gt;
&lt;p&gt;Okay, so this does indeed show the topography of the LA metro area.
The San Gabriel Mountains are in the bright spot in the center,
the Santa Monica Mountains/Hollywood Hills are to the southwest of them.
The Palos Verdes peninsula is visible to the south of those, and Catalina
Island can be seen at the bottom.&lt;/p&gt;
&lt;p&gt;However, this image doesn't really pop. It turns out that
visualization of topography works better with what is known as hillshading.
This takes elevation data and shades it as if a light were shining on the
slopes (usually with some vertical exaggeration). The resulting lumination
map makes it much clearer to the human eye.
Thankfully, matplotlib contains an illumination tool that does the job for us:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.colors&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;LightSource&lt;/span&gt;

&lt;span class="c1"&gt;# Generate the hillshaded intensity&lt;/span&gt;
&lt;span class="n"&gt;ls&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;LightSource&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;intensity&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hillshade&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;z_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vert_exag&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the intensity&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intensity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gist_gray&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_hillshade.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="socal_hillshade" src="/articles/transit/images/socal_hillshade.png"&gt;&lt;/p&gt;
&lt;p&gt;Much better! We can much more easily see the topographic features of the region,
including the coastal plain, the San Fernando and San Gabriel Valleys, and the San
Andreas fault.&lt;/p&gt;
&lt;p&gt;Finally, it would be nice to have the water show up as blue.
We can do this by making a masked array for where the elevation is zero,
and color that blue:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy.ma&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;ma&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;matplotlib.colors&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;LinearSegmentedColormap&lt;/span&gt;

&lt;span class="c1"&gt;# Construct a mask for water&lt;/span&gt;
&lt;span class="n"&gt;water&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ma&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;masked_where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;z_data&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ones_like&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;z_data&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c1"&gt;# Set up the axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the hillshade&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intensity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gist_gray&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;#Make a pure blue colormap, and plot the water mask&lt;/span&gt;
&lt;span class="n"&gt;cm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;LinearSegmentedColormap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;water&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
     &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;169&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;204&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;227&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),(&lt;/span&gt;&lt;span class="mi"&gt;169&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;204&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;227&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;water&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_hillshade_water.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="socal_hillshade" src="/articles/transit/images/socal_hillshade_water.png"&gt;
Okay, &lt;em&gt;this&lt;/em&gt; is something we can work with.&lt;/p&gt;
&lt;h1&gt;Plotting the cities&lt;/h1&gt;
&lt;h2&gt;Drawing shapes&lt;/h2&gt;
&lt;p&gt;Unlike the above, which was raster data, the city boundaries are vector data,
and require a different pipeline for plotting them.
We have already preprocessed the data into shapefiles above, for which cartopy has a reader.&lt;/p&gt;
&lt;p&gt;We can loop over the entries in the shapefiles and plot them by running the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cartopy.io&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;shapereader&lt;/span&gt;
&lt;span class="n"&gt;reader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;shapereader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Reader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data/la_cities/multipolygons.shp&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Set up the map axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the shapes in the database&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; 
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_cities.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-monochrome" src="/articles/transit/images/socal_cities.png"&gt;&lt;/p&gt;
&lt;p&gt;This map isn't terrible, but it is awfully monochromatic.
We would like to have a map where the cities colored so that
it is easier to distinguish them.&lt;/p&gt;
&lt;h2&gt;Assigning colors&lt;/h2&gt;
&lt;p&gt;Let's start by getting a qualitative colormap from the great
&lt;a href="http://colorbrewer2.org/#type=qualitative&amp;amp;scheme=Set1&amp;amp;n=6"&gt;ColorBrewer&lt;/a&gt;,
and cycling throught them to assign colors to the map.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;itertools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;cycle&lt;/span&gt;

&lt;span class="c1"&gt;# Create the color cycle&lt;/span&gt;
&lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#e41a1c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#377eb8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#4daf4a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#984ea3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#ff7f00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#ffff33&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;colorcycle&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cycle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Set up the map axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the city shapes&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colorcycle&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_cities_color.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-color" src="/articles/transit/images/socal_cities_color.png"&gt;&lt;/p&gt;
&lt;p&gt;This is looking much better! However, if you look closely,
you can see that there are many places where neighboring cities
have been assigned the same color, which looks kind of funky,
and makes the boundaries between them difficult to spot.
We would like to set it up so that neighboring cities are not the same color.&lt;/p&gt;
&lt;p&gt;As it happens, this problem is a classic one in graph theory, known
as &lt;a href="https://en.wikipedia.org/wiki/Graph_coloring"&gt;graph coloring&lt;/a&gt;. One of
the most famous theorems in mathematics is the 
&lt;a href="https://en.wikipedia.org/wiki/Four_color_theorem"&gt;four color theorem&lt;/a&gt;,
which (roughly) states that you can color a map so that no regions have a
neighbor of the same color using only four colors. This theorem was among
the first to be proved using a computer.&lt;/p&gt;
&lt;p&gt;For our purposes, we can come up with a map coloring somewhat more easily
by using more colors than four (six, in our case), and applying a
&lt;a href="https://en.wikipedia.org/wiki/Greedy_algorithm"&gt;greedy algorithm&lt;/a&gt;.
The algorithm goes as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Compute the neighbors of each city by checking whether their boundaries intersect.&lt;/li&gt;
&lt;li&gt;Sort the cities in order of having the most neighbors to the least.&lt;/li&gt;
&lt;li&gt;Iterate through the list of cities in order. For each city pick a color that none of its neighbors are currently assigned.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As long as we have enough colors, we should be able to finds a coloring that
works using this algorithm.
We can check the intersection of two boundaries using the &lt;code&gt;intersects()&lt;/code&gt;
function on the shapefile geometries.
The following function accomplishes that,
along with sorting the resulting dictionary:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;collections&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;OrderedDict&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;generate_intersections&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Make a dictionary to store the neighbors list of each city&lt;/span&gt;
    &lt;span class="n"&gt;intersections&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="c1"&gt;# Iterate over the cities&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;city1&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="n"&gt;name1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;city1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="c1"&gt;# Break early if there is an invalid or duplicate name&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name1&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;name1&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;continue&lt;/span&gt;
        &lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="c1"&gt;# Check if each other city intersects the current one&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;city2&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
            &lt;span class="n"&gt;name2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;city2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="c1"&gt;# Break early if there is an invalid or duplicate name&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;name1&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;name2&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;name2&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
                &lt;span class="k"&gt;continue&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;city1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intersects&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;city2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;name1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt; intersects &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;name2&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;# Once we have the intersections dictionary, sort them from most to least neighbors&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;OrderedDict&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; \
           &lt;span class="nb"&gt;sorted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intersections&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="p"&gt;]),&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once we have the ordered neighbors map from &lt;code&gt;generate_intersections()&lt;/code&gt;,
we can apply the greedy color assignment (step 3):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;random&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;greedy_coloring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;neighbors_map&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Make a dictionary for storing the city colors&lt;/span&gt;
    &lt;span class="n"&gt;colormap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="c1"&gt;# For this each city, try to find a color&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;city&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;neighbors&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;neighbors_map&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
        &lt;span class="c1"&gt;# loop over the colors&lt;/span&gt;
        &lt;span class="n"&gt;random&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shuffle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="c1"&gt;# Check if that color has not been used by one of the neighbors&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;neighbor&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;neighbors&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;neighbor&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;colormap&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;neighbor&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="k"&gt;break&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="c1"&gt;# We found a color for the city that has not been used by a neighbor!&lt;/span&gt;
                &lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;city&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;
                &lt;span class="k"&gt;break&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;city&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Could not find color for &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;city&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;colormap&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;So the whole calculation for color assignment looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#e41a1c&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#377eb8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#4daf4a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#984ea3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#ff7f00&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#ffff33&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;colormap&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;greedy_coloring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;generate_intersections&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;And we can then create recreate the map using these color assignments:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Set up the map axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the city shapes &lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;
    &lt;span class="c1"&gt;# Skip regions with invalid names&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;

    &lt;span class="c1"&gt;# Draw the shapes with their assigned color&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_cities_color_2.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-color-2" src="/articles/transit/images/socal_cities_color_2.png"&gt;
Much better!&lt;/p&gt;
&lt;h2&gt;Adding labels&lt;/h2&gt;
&lt;p&gt;This map is still not that useful if we want to know the names of any of the cities shown.
We can naively try to plot them at the center of each city:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Set up the map axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the city shapes&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;
    &lt;span class="c1"&gt;# Skip regions with invalid names&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;

    &lt;span class="c1"&gt;# Draw the shapes with their assigned color&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; 
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
                      &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Get the x and y position of the labels&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;
    &lt;span class="c1"&gt;# Add the label text&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip_on&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;ha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;va&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_cities_color_labels.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-color-labels" src="/articles/transit/images/socal_cities_color_labels.png"&gt;&lt;/p&gt;
&lt;p&gt;This is okay, but in some of the densest areas, the labels are overlapping each other.
Furthermore, it would be nice for the labels for large, populous cities (like LA proper)
to have larger labels than tiny towns. We could scale the label sizes with the population
size, but then the label for Los Angeles  (population several million) would be about
four hundred times the size of the label for the City of Industry (population two-hundred).
Instead, we will scale the label size with the log of the population.&lt;/p&gt;
&lt;p&gt;First, we can create a dictionary holding the population of each city:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;

&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data/la_cities.geojson&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;city_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;population&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;city_data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;features&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;properties&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="c1"&gt;# Some populations contain commas, so strip those&lt;/span&gt;
    &lt;span class="n"&gt;pop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;properties&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;population&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;
    &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pop&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Now, we can recreate the labeled map using the appropriately-scaled labels:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Set up the axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Draw the city shapes&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;

    &lt;span class="c1"&gt;# Skip regions with invalid names&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; 
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
                      &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Get the x and y position of the labels&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;
    &lt;span class="c1"&gt;# If the population is in the population map (as it is for most cities),&lt;/span&gt;
    &lt;span class="c1"&gt;# assign the font size to the log of the population&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log10&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;3.&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; 
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log10&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;3.&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip_on&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;ha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;va&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_cities_color_labels_2.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-color-labels2" src="/articles/transit/images/socal_cities_color_labels_2.png"&gt;&lt;/p&gt;
&lt;h1&gt;Putting it all together&lt;/h1&gt;
&lt;p&gt;We are now ready to make the final map. We will plot the following, in order:
1. SRTM hillshade data
1. City polygons
1. Water mask
1. City labels&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Set up the map axes&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_extent&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;119.31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;116.9998611&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;33.32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;34.74&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="c1"&gt;# Full LA metro area&lt;/span&gt;

&lt;span class="c1"&gt;# Plot the hillshade&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intensity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;gist_gray&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Draw the city shapes&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;reader&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;records&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;attributes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;geometry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;

    &lt;span class="c1"&gt;# Skip regions with invalid names&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;continue&lt;/span&gt;

    &lt;span class="c1"&gt;# Draw the shapes with their assigned color&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add_geometries&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; 
                      &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;colormap&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
                      &lt;span class="n"&gt;edgecolor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="c1"&gt;# Get the x and y position of the labels&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;geometry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;centroid&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;
    &lt;span class="c1"&gt;# If the population is in the population map (as it is for most cities),&lt;/span&gt;
    &lt;span class="c1"&gt;# assign the font size to the log of the population&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log10&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;3.&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;population&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; 
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log10&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;3.&lt;/span&gt;
    &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;clip_on&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;ha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;va&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ccrs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PlateCarree&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;

&lt;span class="c1"&gt;#Make a pure blue colormap, and plot the water mask&lt;/span&gt;
&lt;span class="n"&gt;cm&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;LinearSegmentedColormap&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;water&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
     &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;169&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;204&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;227&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),(&lt;/span&gt;&lt;span class="mi"&gt;169&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;204&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;227&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
&lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;water&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cmap&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;upper&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;srtm_extent&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;zorder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savefig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;images/socal_total.png&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bbox_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;tight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dpi&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="los-angeles-total" src="/articles/transit/images/socal_total.png"&gt;
And we are basically done!&lt;/p&gt;
&lt;h1&gt;Conclusions&lt;/h1&gt;
&lt;p&gt;There are a bunch of more detailed tweaks that can make this map better than
what I have shown here. There are duplicate entries to remove, labels to move around,
and colors to shift. The maps shown at the top of this post have those tweaks incorporated.&lt;/p&gt;
&lt;p&gt;I'll close with a few scattered thoughts about the process of making this map:&lt;/p&gt;
&lt;p&gt;First, the data provided by OpenStreetMap is pretty great. It is free, downloadable,
and has a &lt;em&gt;huge&lt;/em&gt; amount of information. The downside is that the databases you download
from OSM are poorly documented, and the data often needs to be substantially cleaned up.
There are a lot of duplicate, contradictory, or nonsense entries. Some things are misclassified.&lt;/p&gt;
&lt;p&gt;Second, the quantity and quality of data downloadable from USGS or NASA is awesome.
However, as above, the web interfaces for locating and downloading it are confusing
and poorly documented.&lt;/p&gt;
&lt;p&gt;Finally, GDAL is indispensable for any kind of GIS processing. It understands just about
any format you can throw at it, and is &lt;em&gt;really&lt;/em&gt; fast. Unfortunately, it also has
confusing and incomplete documentation (are you sensing a theme here?).&lt;/p&gt;
&lt;p&gt;Feel free to let me know if you find this useful!&lt;/p&gt;</content></entry></feed>